(function(e){if(Modernizr.track&&Modernizr.texttrackapi&&document.addEventListener){var t=webshims.cfg.track,n=function(t){e(t.target).filter("track").each(a)},i=webshims.bugs.track,a=function(){return i||!t.override&&3==e.prop(this,"readyState")?(t.override=!0,webshims.reTest("track"),document.removeEventListener("error",n,!0),this&&e.nodeName(this,"track")?webshims.error("track support was overwritten. Please check your vtt including your vtt mime-type"):webshims.info("track support was overwritten. due to bad browser support"),!1):void 0},r=function(){document.addEventListener("error",n,!0),i?a():e("track").each(a)};t.override||r()}})(jQuery),webshims.register("track-ui",function(e,t){"use strict";function n(e,t){var n=!0,i=0,a=e.length;if(a!=t.length)n=!1;else for(;a>i;i++)if(e[i]!=t[i]){n=!1;break}return n}var i=t.cfg.track,a={subtitles:1,captions:1,descriptions:1},r=t.mediaelement,o=function(){return!i.override&&Modernizr.track},s={update:function(i,a){i.activeCues.length?n(i.displayedActiveCues,i.activeCues)||(i.displayedActiveCues=i.activeCues,i.trackDisplay||(i.trackDisplay=e('<div class="cue-display"><span class="description-cues" aria-live="assertive" /></div>').insertAfter(a),this.addEvents(i,a),t.docObserve()),i.hasDirtyTrackDisplay&&a.triggerHandler("forceupdatetrackdisplay"),this.showCues(i)):this.hide(i)},showCues:function(t){var n=e('<span class="cue-wrapper" />');e.each(t.displayedActiveCues,function(i,a){var r=a.id?'id="cue-id-'+a.id+'"':"",o=e('<span class="cue-line"><span '+r+' class="cue" /></span>').find("span").html(a.getCueAsHTML()).end();"descriptions"==a.track.kind?setTimeout(function(){e("span.description-cues",t.trackDisplay).html(o)},0):n.prepend(o)}),e("span.cue-wrapper",t.trackDisplay).remove(),t.trackDisplay.append(n)},addEvents:function(e,t){if(i.positionDisplay){var n,a=function(n){if(e.displayedActiveCues.length||n===!0){e.trackDisplay.css({display:"none"});var i=t.getShadowElement();i.offsetParent();var a=i.innerHeight(),r=i.innerWidth(),o=i.position();e.trackDisplay.css({left:o.left,width:r,height:a-45,top:o.top,display:"block"}),e.trackDisplay.css("fontSize",Math.max(Math.round(a/30),7)),e.hasDirtyTrackDisplay=!1}else e.hasDirtyTrackDisplay=!0},r=function(){clearTimeout(n),n=setTimeout(a,0)},o=function(){a(!0)};t.on("playerdimensionchange mediaelementapichange updatetrackdisplay updatemediaelementdimensions swfstageresize",r),t.on("forceupdatetrackdisplay",o).onWSOff("updateshadowdom",r),o()}},hide:function(t){t.trackDisplay&&t.displayedActiveCues.length&&(t.displayedActiveCues=[],e("span.cue-wrapper",t.trackDisplay).remove(),e("span.description-cues",t.trackDisplay).empty())}};if(e.extend(e.event.customEvent,{updatetrackdisplay:!0,forceupdatetrackdisplay:!0}),r.trackDisplay=s,!r.createCueList){var u={getCueById:function(e){for(var t=null,n=0,i=this.length;i>n;n++)if(this[n].id===e){t=this[n];break}return t}};r.createCueList=function(){return e.extend([],u)}}r.getActiveCue=function(t,n,o,s){t._lastFoundCue||(t._lastFoundCue={index:0,time:0}),!Modernizr.track||i.override||t._shimActiveCues||(t._shimActiveCues=r.createCueList());for(var u,l,c=0;t.shimActiveCues.length>c;c++)l=t.shimActiveCues[c],l.startTime>o||o>l.endTime?(t.shimActiveCues.splice(c,1),c--,l.pauseOnExit&&e(n).pause(),e(t).triggerHandler("cuechange"),e(l).triggerHandler("exit")):"showing"==t.mode&&a[t.kind]&&-1==e.inArray(l,s.activeCues)&&s.activeCues.push(l);for(u=t.cues.length,c=o>t._lastFoundCue.time?t._lastFoundCue.index:0;u>c&&(l=t.cues[c],o>=l.startTime&&l.endTime>=o&&-1==e.inArray(l,t.shimActiveCues)&&(t.shimActiveCues.push(l),"showing"==t.mode&&a[t.kind]&&s.activeCues.push(l),e(t).triggerHandler("cuechange"),e(l).triggerHandler("enter"),t._lastFoundCue.time=o,t._lastFoundCue.index=c),!(l.startTime>o));c++);},o()&&function(){var n,i=function(t){setTimeout(function(){n=!0,e(t).triggerHandler("updatetrackdisplay"),n=!1},9)},a=function(a,r,s){var u,l="_sup"+s,c={prop:{}};c.prop[s]=function(){return!n&&o()&&i(e(this).closest("audio, video")),u.prop[l].apply(this,arguments)},u=t.defineNodeNameProperty(a,r,c)};a("track","track","get"),["audio","video"].forEach(function(e){a(e,"textTracks","get"),a("nodeName","addTextTrack","value")})}(),t.addReady(function(n,i){e("video, audio",n).add(i.filter("video, audio")).filter(function(){return t.implement(this,"trackui")}).each(function(){var n,i,a,u=e(this),l=function(){var e,a;if(i&&n||(i=u.prop("textTracks"),n=t.data(u[0],"mediaelementBase")||t.data(u[0],"mediaelementBase",{}),n.displayedActiveCues||(n.displayedActiveCues=[])),i&&(a=u.prop("currentTime"),a||0===a)){n.activeCues=[];for(var o=0,l=i.length;l>o;o++)e=i[o],"disabled"!=e.mode&&e.cues&&e.cues.length&&r.getActiveCue(e,u,a,n);s.update(n,u)}},c=function(e){clearTimeout(a),e&&"timeupdate"==e.type?(l(),setTimeout(c,90)):a=setTimeout(l,9)},d=function(){u.off(".trackview").on("play.trackview timeupdate.trackview updatetrackdisplay.trackview",c)};o()?u.on("mediaelementapichange trackapichange",function(){!o()||u.is(".nonnative-api-active")?d():(i=u.prop("textTracks"),n=t.data(u[0],"mediaelementBase")||t.data(u[0],"mediaelementBase",{}),e.each(i,function(e,t){t._shimActiveCues&&delete t._shimActiveCues}),s.hide(n),u.unbind(".trackview"))}):d()})})});