jQuery.webshims.register("track-ui",function(f,h){var k=h.cfg.track,m={subtitles:1,captions:1},l=h.mediaelement,n={update:function(a,b){if(a.activeCues.length){if(!this.compareArray(a.displayedActiveCues,a.activeCues)){a.displayedActiveCues=a.activeCues;if(!a.trackDisplay)a.trackDisplay=f('<div class="cue-display"></div>').insertAfter(b),this.addEvents(a,b);a.hasDirtyTrackDisplay&&b.triggerHandler("forceupdatetrackdisplay");this.showCues(a)}}else this.hide(a)},showCues:function(a){var b=f('<span class="cue-wrapper" />');
f.each(a.displayedActiveCues,function(a,c){b.append(f("<span "+(c.id?'id="cue-id-'+c.id+'"':"")+' class="cue" />').html(c.getCueAsHTML()))});a.trackDisplay.html(b)},compareArray:function(a,b){var d=!0,c=0,g=a.length;if(g!=b.length)d=!1;else for(;c<g;c++)if(a[c]!=b[c]){d=!1;break}return d},addEvents:function(a,b){if(k.positionDisplay){var d,c=function(d){if(a.displayedActiveCues.length||!0===d){a.trackDisplay.css({display:"none"});var c=b.getShadowElement();c.offsetParent();var d=c.innerHeight(),g=
c.innerWidth(),c=c.position();a.trackDisplay.css({left:c.left,width:g,height:d-45,top:c.top,display:"block"});a.trackDisplay.css("fontSize",Math.max(Math.round(d/30),7));a.hasDirtyTrackDisplay=!1}else a.hasDirtyTrackDisplay=!0},g=function(){c(!0)};b.bind("updateshadowdom playerdimensionchange mediaelementapichange updatetrackdisplay updatemediaelementdimensions swfstageresize",function(){clearTimeout(d);d=setTimeout(c,0)});b.bind("forceupdatetrackdisplay",g);g()}},hide:function(a){if(a.trackDisplay&&
a.displayedActiveCues.length)a.displayedActiveCues=[],a.trackDisplay.empty()}};f.extend(f.event.customEvent,{updatetrackdisplay:!0,forceupdatetrackdisplay:!0});l.trackDisplay=n;if(!l.createCueList){var o={getCueById:function(a){for(var b=null,d=0,c=this.length;d<c;d++)if(this[d].id===a){b=this[d];break}return b}};l.createCueList=function(){return f.extend([],o)}}l.getActiveCue=function(a,b,d,c){if(!a._lastFoundCue)a._lastFoundCue={index:0,time:0};if(Modernizr.track&&!k.override&&!a._shimActiveCues)a._shimActiveCues=
l.createCueList();for(var g=0,e;g<a.shimActiveCues.length;g++)e=a.shimActiveCues[g],e.startTime>d||e.endTime<d?(a.shimActiveCues.splice(g,1),g--,e.pauseOnExit&&f(b).pause(),f(a).triggerHandler("cuechange"),f(e).triggerHandler("exit")):"showing"==a.mode&&m[a.kind]&&-1==f.inArray(e,c.activeCues)&&c.activeCues.push(e);b=a.cues.length;for(g=a._lastFoundCue.time<d?a._lastFoundCue.index:0;g<b;g++){e=a.cues[g];if(e.startTime<=d&&e.endTime>=d&&-1==f.inArray(e,a.shimActiveCues))a.shimActiveCues.push(e),"showing"==
a.mode&&m[a.kind]&&c.activeCues.push(e),f(a).triggerHandler("cuechange"),f(e).triggerHandler("enter"),a._lastFoundCue.time=d,a._lastFoundCue.index=g;if(e.startTime>d)break}};!k.override&&Modernizr.track&&function(){var a,b=function(d){!a&&!k.override&&Modernizr.track&&setTimeout(function(){a=!0;f(d).triggerHandler("updatetrackdisplay");a=!1},9)},d=h.defineNodeNameProperty("track","track",{prop:{get:function(){b(f(this).parent("audio, video"));return d.prop._supget.apply(this,arguments)}}});["audio",
"video"].forEach(function(a){var d,e;e=h.defineNodeNameProperty(a,"textTracks",{prop:{get:function(){b(this);return e.prop._supget.apply(this,arguments)}}});d=h.defineNodeNameProperty(a,"addTextTrack",{prop:{value:function(){b(this);return d.prop._supvalue.apply(this,arguments)}}})})}();h.addReady(function(a,b){f("video, audio",a).add(b.filter("video, audio")).each(function(){var a=f(this),c=function(){var b,c;if(!j||!i)if(j=a.prop("textTracks"),i=h.data(a[0],"mediaelementBase")||h.data(a[0],"mediaelementBase",
{}),!i.displayedActiveCues)i.displayedActiveCues=[];if(j&&((c=a.prop("currentTime"))||0===c)){i.activeCues=[];for(var e=0,f=j.length;e<f;e++)b=j[e],"disabled"!=b.mode&&b.cues&&b.cues.length&&l.getActiveCue(b,a,c,i);n.update(i,a)}},b=function(a){clearTimeout(m);a&&"timeupdate"==a.type?(c(),setTimeout(b,90)):m=setTimeout(c,9)},e=function(){a.unbind(".trackview").bind("play.trackview timeupdate.trackview updatetrackdisplay.trackview",b)},i,j,m;!k.override&&Modernizr.track?a.bind("mediaelementapichange trackapichange",
function(){k.override||!Modernizr.track||a.is(".nonnative-api-active")?e():(j=a.prop("textTracks"),i=h.data(a[0],"mediaelementBase")||h.data(a[0],"mediaelementBase",{}),f.each(j,function(a,b){b._shimActiveCues&&delete b._shimActiveCues}),n.hide(i),a.unbind(".trackview"))}):e()})})});
