jQuery.webshims.register("track",function(f,g,l,r){var h=g.mediaelement;(new Date).getTime();var v={subtitles:1,captions:1},s=function(){g.error("not implemented yet")},o=function(a){var c={};a.addEventListener=function(b,a){c[b]&&g.error("always use $.bind to the shimed event: "+b+" already bound fn was: "+c[b]+" your fn was: "+a);c[b]=a};a.removeEventListener=function(a,e){c[a]&&c[a]!=e&&g.error("always use $.bind to the shimed event: "+a+" already bound fn was: "+c[a]+" your fn was: "+e);c[a]&&
delete c[a]};return a},w={getCueById:s},x={shimActiveCues:null,_shimActiveCues:null,activeCues:null,cues:null,kind:"subtitles",label:"",language:"",mode:0,readyState:0,oncuechange:null,toString:function(){return"[object TextTrack]"},addCue:function(a){if(!this.cues)this.cues=[];a.track&&g.error("cue already part of a track element");a.track=this;this.cues.push(a)},removeCue:s,DISABLED:0,OFF:0,HIDDEN:1,SHOWING:2,ERROR:3,LOADED:2,LOADING:1,NONE:0},y=["kind","label","srclang"],z=Function.prototype.call.bind(Object.prototype.hasOwnProperty),
p=function(){var a=f.prop(this,"textTracks"),c=g.data(this,"mediaelementBase"),b=a.splice(0),e,d;f("track",this).each(function(){a.push(f.prop(this,"track"))});if(c.scriptedTextTracks)for(e=0,d=c.scriptedTextTracks.length;e<d;e++)a.push(c.scriptedTextTracks[e]);if(h.trackDisplay&&c.trackDisplay)for(e=0,d=b.length;e<d;e++)-1==a.indexOf(b[e])&&h.trackDisplay.hide(b[e],c)},t=function(a,c){var b;c||(c=g.data(a,"trackData"));if(c&&!c.isTriggering)c.isTriggering=!0,b=(c.track||{}).mode,setTimeout(function(){if(b!==
(c.track||{}).mode)(c.track||{}).readyState?f(a).parent().triggerHandler("updatetrackdisplay"):f(a).triggerHandler("checktrackmode");c.isTriggering=!1},9)};if(!l.TextTrackCue){var q=f("<div />")[0];l.TextTrackCue=function(a,c,b,e,d,n){this.id=a;this.startTime=c;this.endTime=b;this.text=e;this.pauseOnExit=n;d&&g.warn("webshims currently does not support any cue settings");o(this)};l.TextTrackCue.prototype={onenter:null,onexit:null,pauseOnExit:!1,getCueAsHTML:function(){var a="",c="",b=r.createDocumentFragment(),
e;if(!z(this,"getCueAsHTML"))e=this.getCueAsHTML=function(){var d,n;if(a!=this.text){a=this.text;c=h.parseCueTextToHTML(a);q.innerHTML=c;for(d=0,n=q.childNodes.length;d<n;d++)b.appendChild(q.childNodes[d].cloneNode(!0))}return b.cloneNode(!0)};return e?e.apply(this,arguments):b.cloneNode(!0)},track:null,id:"",snapToLines:!0,line:-1,size:100,position:50,vertical:"",align:"middle"}}h.createCueList=function(){return f.extend([],w)};h.parseCueTextToHTML=function(){var a=/(<\/?[^>]+>)/ig,c=/^(?:c|v|ruby|rt|b|i|u)/,
b=/\<\s*\//,e=function(a,c,d,e){b.test(e)?a="</"+a+">":(d.splice(0,1),a="<"+a+" "+c+'="'+d.join(" ").replace(/\"/g,"&quot;")+'">');return a},d=function(a){var b=a.replace(/[<\/>]+/ig,"").split(/[\s\.]+/);b[0]&&(b[0]=b[0].toLowerCase(),c.test(b[0])?"c"==b[0]?(b.splice(0,1),a=e("span","class",b,a)):"v"==b[0]&&(a=e("q","title",b,a)):a="");return a};return function(b){return b.replace(a,d)}}();h.createTextTrack=function(a,c){var b,e,d;if(c.nodeName&&(e=g.data(c,"trackData")))t(c,e),b=e.track;if(!b)if(b=
o(g.objectCreate(x)),y.forEach(function(a){var d=f.prop(c,a);d&&("srclang"==a&&(a="language"),b[a]=d)}),c.nodeName){if(d=function(){var e,u;if(b.mode&&(f(a).unbind("play playing timeupdate updatetrackdisplay",d),f(c).unbind("checktrackmode",d),!b.readyState)){e=function(){b.readyState=3;f(c).triggerHandler("error")};b.readyState=1;try{u=f.ajax({dataType:"text",url:f.prop(c,"src"),success:function(d){"text/vtt"!=u.getResponseHeader("content-type")&&g.warn("set the mime-type of your WebVTT files to text/vtt. see: http://dev.w3.org/html5/webvtt/#text/vtt");
h.parseCaptions(d,b,function(d){d&&"length"in d?(b.cues=d,b.activeCues=b.shimActiveCues=b._shimActiveCues=h.createCueList(),b.readyState=2,f(c).triggerHandler("load"),f(a).triggerHandler("updatetrackdisplay")):e()})},error:e})}catch(m){e(),g.warn(m)}}},e=g.data(c,"trackData",{track:b}),f(a).bind("play playing timeupdate updatetrackdisplay",d),f(c).bind("checktrackmode",d),f.prop(c,"default"))b.mode=v[b.kind]?2:1,d()}else b.cues=h.createCueList(),b.activeCues=b._shimActiveCues=b.shimActiveCues=h.createCueList(),
b.mode=1,b.readyState=2;return b};h.parseCaptionChunk=function(){var a=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,c=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g,b=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g,e=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g;return function(d,f){var g="",h=[],i,k,j,l;if(h=c.exec(d))return h=h.slice(2).join(""),h=h.split(/\s+/g).filter(function(a){return a&&!!a.length}),null;if(h=b.exec(d))return g+=h[h.length-1],null;if(h=e.exec(d))return null;
for(i=d.split(/\n/g);!i[0].replace(/\s+/ig,"").length&&0<i.length;)i.shift();for(h=i[0].match(/^\s*[a-z0-9]+\s*$/ig)?""+i.shift().replace(/\s*/ig,""):f;0<i.length;){if(l=a.exec(i[0]))j=l.slice(1),k=parseInt(3600*(j[0]||0),10)+parseInt(60*(j[1]||0),10)+parseInt(j[2]||0,10)+parseFloat("0."+(j[3]||0)),j=parseInt(3600*(j[4]||0),10)+parseInt(60*(j[5]||0),10)+parseInt(j[6]||0,10)+parseFloat("0."+(j[7]||0));i=i.slice(0,0).concat(i.slice(1));break}if(!k&&!j)return null;i=i.join("\n");k=new TextTrackCue(h,
k,j,i,"",!1);k.styleData=g;return k}}();h.parseCaptions=function(a,c,b){var e=h.createCueList(),d,f,l,m,i;if(a)l=/^WEBVTT(\s*FILE)?/ig,f=function(k,j){for(;k<j;k++){d=a[k];if(l.test(d))i=!0;else if(d.replace(/\s*/ig,"").length){if(!i){g.error("please use WebVTT format. This is the standard");b(null);break}if(d=h.parseCaptionChunk(d,k))d.track=c,e.push(d)}if(m<(new Date).getTime()-9){k++;setTimeout(function(){m=(new Date).getTime();f(k,j)},90);break}}k>=j&&(i||g.error("please use WebVTT format. This is the standard"),
b(e))},a=a.replace(/\r\n/g,"\n"),setTimeout(function(){a=a.replace(/\r/g,"\n");setTimeout(function(){m=(new Date).getTime();a=a.split(/\n\n+/g);f(0,a.length)},9)},9);else throw Error("Required parameter captionData not supplied.");};h.createTrackList=function(a){a=g.data(a,"mediaelementBase")||g.data(a,"mediaelementBase",{});if(!a.textTracks)a.textTracks=[],g.defineProperties(a.textTracks,{onaddtrack:{value:null}}),o(a.textTracks);return a.textTracks};Modernizr.track||(g.defineNodeNamesBooleanProperty(["track"],
"default"),g.reflectProperties(["track"],["srclang","label"]),g.defineNodeNameProperties("track",{kind:{reflect:!0,propType:"enumarated",defaultValue:"subtitles",limitedTo:["subtitles","captions","descriptions","chapters","metadata"]},src:{reflect:!0,propType:"src"}}));g.defineNodeNamesProperties(["track"],{ERROR:{value:3},LOADED:{value:2},LOADING:{value:1},NONE:{value:0},track:{get:function(){return h.createTextTrack(f(this).closest("audio, video")[0],this)},writeable:!1}},"prop");g.defineNodeNamesProperties(["audio",
"video"],{textTracks:{get:function(){f("track",this).each(function(){t(this)});return h.createTrackList(this)},writeable:!1},addTextTrack:{value:function(a,c,b){a=h.createTextTrack(this,{kind:a||"",label:c||"",srclang:b||""});c=g.data(this,"mediaelementBase")||g.data(this,"mediaelementBase",{});if(!c.scriptedTextTracks)c.scriptedTextTracks=[];c.scriptedTextTracks.push(a);p.call(this);return a}}},"prop");f(r).bind("emptied",function(a){f(a.target).is("audio, video")&&setTimeout(function(){p.call(a.target)},
9)});g.addReady(function(a,c){f("video, audio",a).add(c.filter("video, audio, track").closest("audio, video")).each(p).each(function(){if(Modernizr.track){var a=this.textTracks;f.prop(this,"textTracks").length!=a.length&&g.error("textTracks couldn't be copied");f("track",this).each(function(){var a=f.prop(this,"track"),b=this.track,c;if(b){c=b.readyState||this.readyState;if(b.mode||c)a.mode=b.mode;b.mode=0;if(!c&&f.prop(this,"default"))f(this).one("load",function(){this.track.mode=0})}}).bind("load error",
function(a){a.originalEvent&&a.stopImmediatePropagation()})}})});Modernizr.track&&f("video, audio").trigger("trackapichange")});
