jQuery.webshims.register("track",function(f,e,r,s){var i=e.mediaelement;(new Date).getTime();var u={subtitles:1,captions:1},m=Modernizr.ES5&&Modernizr.objectAccessor,p=function(a){var b={};a.addEventListener=function(a,g){b[a]&&e.error("always use $.bind to the shimed event: "+a+" already bound fn was: "+b[a]+" your fn was: "+g);b[a]=g};a.removeEventListener=function(a,g){b[a]&&b[a]!=g&&e.error("always use $.bind/$.unbind to the shimed event: "+a+" already bound fn was: "+b[a]+" your fn was: "+g);
b[a]&&delete b[a]};return a},v={getCueById:function(a){for(var b=null,d=0,g=this.length;d<g;d++)if(this[d].id===a){b=this[d];break}return b}},w={shimActiveCues:null,_shimActiveCues:null,activeCues:null,cues:null,kind:"subtitles",label:"",language:"",mode:"disabled",readyState:0,oncuechange:null,toString:function(){return"[object TextTrack]"},addCue:function(a){if(this.cues){var b=this.cues[this.cues.length-1];b&&b.startTime>a.startTime&&e.error("cue startTime higher than previous cue's startTime")}else this.cues=
i.createCueList();a.track&&a.track.removeCue&&a.track.removeCue(a);a.track=this;this.cues.push(a)},removeCue:function(a){var b=this.cues||[],d=0,g=b.length;if(a.track!=this)e.error("cue not part of track");else{for(;d<g;d++)if(b[d]===a){b.splice(d,1);a.track=null;break}a.track&&e.error("cue not part of track")}},DISABLED:"disabled",OFF:"disabled",HIDDEN:"hidden",SHOWING:"showing",ERROR:3,LOADED:2,LOADING:1,NONE:0},n=["kind","label","srclang"],o={srclang:"language"},x=Function.prototype.call.bind(Object.prototype.hasOwnProperty),
j=function(a,b){var d=[],g=[],c=[],h,k;a||(a=e.data(this,"mediaelementBase")||e.data(this,"mediaelementBase",{}));if(!b)a.blockTrackListUpdate=!0,b=f.prop(this,"textTracks"),a.blockTrackListUpdate=!1;clearTimeout(a.updateTrackListTimer);f("track",this).each(function(){var a=f.prop(this,"track");c.push(a);-1==b.indexOf(a)&&g.push(a)});if(a.scriptedTextTracks)for(h=0,k=a.scriptedTextTracks.length;h<k;h++)c.push(a.scriptedTextTracks[h]),-1==b.indexOf(a.scriptedTextTracks[h])&&g.push(a.scriptedTextTracks[h]);
for(h=0,k=b.length;h<k;h++)-1==c.indexOf(b[h])&&d.push(b[h]);if(d.length||g.length){b.splice(0);for(h=0,k=c.length;h<k;h++)b.push(c[h]);for(h=0,k=d.length;h<k;h++)f([b]).triggerHandler(f.Event({type:"removetrack",track:b,track:d[h]}));for(h=0,k=g.length;h<k;h++)f([b]).triggerHandler(f.Event({type:"addtrack",track:b,track:g[h]}));(a.scriptedTextTracks||d.length)&&f(this).triggerHandler("updatetrackdisplay")}},t=function(a,b){b||(b=e.data(a,"trackData"));if(b&&!b.isTriggering)b.isTriggering=!0,setTimeout(function(){(b.track||
{}).readyState?f(a).parent().triggerHandler("updatetrackdisplay"):f(a).triggerHandler("checktrackmode");b.isTriggering=!1},1)},q=f("<div />")[0];r.TextTrackCue=function(a,b,d){3!=arguments.length&&e.error("wrong arguments.length for TextTrackCue.constructor");this.startTime=a;this.endTime=b;this.text=d;this.id="";this.pauseOnExit=!1;p(this)};r.TextTrackCue.prototype={onenter:null,onexit:null,pauseOnExit:!1,getCueAsHTML:function(){var a="",b="",d=s.createDocumentFragment(),g;if(!x(this,"getCueAsHTML"))g=
this.getCueAsHTML=function(){var c,h;if(a!=this.text){a=this.text;b=i.parseCueTextToHTML(a);q.innerHTML=b;for(c=0,h=q.childNodes.length;c<h;c++)d.appendChild(q.childNodes[c].cloneNode(!0))}return d.cloneNode(!0)};return g?g.apply(this,arguments):d.cloneNode(!0)},track:null,id:""};i.createCueList=function(){return f.extend([],v)};i.parseCueTextToHTML=function(){var a=/(<\/?[^>]+>)/ig,b=/^(?:c|v|ruby|rt|b|i|u)/,d=/\<\s*\//,g=function(a,b,c,g){d.test(g)?a="</"+a+">":(c.splice(0,1),a="<"+a+" "+b+'="'+
c.join(" ").replace(/\"/g,"&#34;")+'">');return a},c=function(a){var c=a.replace(/[<\/>]+/ig,"").split(/[\s\.]+/);c[0]&&(c[0]=c[0].toLowerCase(),b.test(c[0])?"c"==c[0]?a=g("span","class",c,a):"v"==c[0]&&(a=g("q","title",c,a)):a="");return a};return function(b){return b.replace(a,c)}}();i.loadTextTrack=function(a,b,d,g){var c=d.track,h=function(){var d=f.prop(b,"src"),g,l;if("disabled"!=c.mode&&d&&f.attr(b,"src")&&(f(a).unbind("play playing timeupdate updatetrackdisplay",h),f(b).unbind("checktrackmode",
h),!c.readyState)){g=function(){c.readyState=3;c.cues=null;c.activeCues=c.shimActiveCues=c._shimActiveCues=null;f(b).triggerHandler("error")};c.readyState=1;try{c.cues=i.createCueList(),c.activeCues=c.shimActiveCues=c._shimActiveCues=i.createCueList(),l=f.ajax({dataType:"text",url:d,success:function(d){"text/vtt"!=l.getResponseHeader("content-type")&&e.error("set the mime-type of your WebVTT files to text/vtt. see: http://dev.w3.org/html5/webvtt/#text/vtt");i.parseCaptions(d,c,function(d){d&&"length"in
d?(c.readyState=2,f(b).triggerHandler("load"),f(a).triggerHandler("updatetrackdisplay")):g()})},error:g})}catch(j){g(),e.warn(j)}}};c.readyState=0;c.shimActiveCues=null;c._shimActiveCues=null;c.activeCues=null;c.cues=null;f(a).unbind("play playing timeupdate updatetrackdisplay",h);f(b).unbind("checktrackmode",h);f(a).bind("play playing timeupdate updatetrackdisplay",h);f(b).bind("checktrackmode",h);if(g)c.mode=u[c.kind]?"showing":"hidden",h()};i.createTextTrack=function(a,b){var d,g;if(b.nodeName&&
(g=e.data(b,"trackData")))t(b,g),d=g.track;if(!d)d=p(e.objectCreate(w)),m||n.forEach(function(a){var g=f.prop(b,a);g&&(d[o[a]||a]=g)}),b.nodeName?(m&&n.forEach(function(a){e.defineProperty(d,o[a]||a,{get:function(){return f.prop(b,a)}})}),g=e.data(b,"trackData",{track:d}),i.loadTextTrack(a,b,g,f.prop(b,"default"))):(m&&n.forEach(function(a){e.defineProperty(d,o[a]||a,{value:b[a],writeable:!1})}),d.cues=i.createCueList(),d.activeCues=d._shimActiveCues=d.shimActiveCues=i.createCueList(),d.mode="hidden",
d.readyState=2);return d};i.parseCaptionChunk=function(){var a=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,b=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g,d=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g,g=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g;return function(c){var h,e,f,i;if(b.exec(c)||d.exec(c)||g.exec(c))return null;for(c=c.split(/\n/g);!c[0].replace(/\s+/ig,"").length&&0<c.length;)c.shift();for(c[0].match(/^\s*[a-z0-9]+\s*$/ig)&&(f=""+c.shift().replace(/\s*/ig,
""));0<c.length;){if(i=a.exec(c[0]))e=i.slice(1),h=parseInt(3600*(e[0]||0),10)+parseInt(60*(e[1]||0),10)+parseInt(e[2]||0,10)+parseFloat("0."+(e[3]||0)),e=parseInt(3600*(e[4]||0),10)+parseInt(60*(e[5]||0),10)+parseInt(e[6]||0,10)+parseFloat("0."+(e[7]||0));c=c.slice(0,0).concat(c.slice(1));break}if(!h&&!e)return null;c=c.join("\n");h=new TextTrackCue(h,e,c);if(f)h.id=f;return h}}();i.parseCaptions=function(a,b,d){i.createCueList();var g,c,h,f,j;a?(h=/^WEBVTT(\s*FILE)?/ig,c=function(l,m){for(;l<m;l++){g=
a[l];if(h.test(g))j=!0;else if(g.replace(/\s*/ig,"").length){if(!j){e.error("please use WebVTT format. This is the standard");d(null);break}(g=i.parseCaptionChunk(g,l))&&b.addCue(g)}if(f<(new Date).getTime()-30){l++;setTimeout(function(){f=(new Date).getTime();c(l,m)},90);break}}l>=m&&(j||e.error("please use WebVTT format. This is the standard"),d(b.cues))},a=a.replace(/\r\n/g,"\n"),setTimeout(function(){a=a.replace(/\r/g,"\n");setTimeout(function(){f=(new Date).getTime();a=a.split(/\n\n+/g);c(0,
a.length)},9)},9)):e.error("Required parameter captionData not supplied.")};i.createTrackList=function(a,b){b=b||e.data(a,"mediaelementBase")||e.data(a,"mediaelementBase",{});if(!b.textTracks)b.textTracks=[],e.defineProperties(b.textTracks,{onaddtrack:{value:null},onremovetrack:{value:null}}),p(b.textTracks);return b.textTracks};Modernizr.track||(e.defineNodeNamesBooleanProperty(["track"],"default"),e.reflectProperties(["track"],["srclang","label"]),e.defineNodeNameProperties("track",{src:{reflect:!0,
propType:"src"}}));e.defineNodeNameProperties("track",{kind:{attr:Modernizr.track?{set:function(a){var b=e.data(this,"trackData");this.setAttribute("data-kind",a);if(b)b.attrKind=a},get:function(){var a=e.data(this,"trackData");return a&&"attrKind"in a?a.attrKind:this.getAttribute("kind")}}:{},reflect:!0,propType:"enumarated",defaultValue:"subtitles",limitedTo:["subtitles","captions","descriptions","chapters","metadata"]}});f.each(n,function(a,b){var d=o[b]||b;e.onNodeNamesPropertyModify("track",
b,function(){var a=e.data(this,"trackData"),c=this;if(a)"kind"==b&&t(this,a),m||(a.track[d]=f.prop(this,b)),clearTimeout(a.changedTrackPropTimer),a.changedTrackPropTimer=setTimeout(function(){f(c).trigger("updatesubtitlestate")},1)})});e.onNodeNamesPropertyModify("track","src",function(a){if(a){var a=e.data(this,"trackData"),b;a&&(b=f(this).closest("video, audio"),b[0]&&i.loadTextTrack(b,this,a))}});e.defineNodeNamesProperties(["track"],{ERROR:{value:3},LOADED:{value:2},LOADING:{value:1},NONE:{value:0},
readyState:{get:function(){return(f.prop(this,"track")||{readyState:0}).readyState},writeable:!1},track:{get:function(){return i.createTextTrack(f(this).closest("audio, video")[0],this)},writeable:!1}},"prop");e.defineNodeNamesProperties(["audio","video"],{textTracks:{get:function(){var a=e.data(this,"mediaelementBase")||e.data(this,"mediaelementBase",{}),b=i.createTrackList(this,a);a.blockTrackListUpdate||j.call(this,a,b);return b},writeable:!1},addTextTrack:{value:function(a,b,d){a=i.createTextTrack(this,
{kind:a||"",label:b||"",srclang:d||""});b=e.data(this,"mediaelementBase")||e.data(this,"mediaelementBase",{});if(!b.scriptedTextTracks)b.scriptedTextTracks=[];b.scriptedTextTracks.push(a);j.call(this);return a}}},"prop");f(s).bind("emptied ended updatetracklist",function(a){if(f(a.target).is("audio, video")){var b=e.data(a.target,"mediaelementBase");if(b)clearTimeout(b.updateTrackListTimer),b.updateTrackListTimer=setTimeout(function(){j.call(a.target,b)},0)}});e.addReady(function(a,b){var d=b.filter("video, audio, track").closest("audio, video");
f("video, audio",a).add(d).each(function(){j.call(this)}).each(function(){if(Modernizr.track){var a=this.textTracks;f.prop(this,"textTracks").length!=a.length&&e.error("textTracks couldn't be copied");f("track",this).each(function(){var a=f.prop(this,"track"),b=this.track,d,e;if(b){d=f.prop(this,"kind");e=b.readyState||this.readyState;if(b.mode||e)a.mode=b.mode;if("descriptions"!=d)b.mode="string"==typeof b.mode?"disabled":0,this.kind="metadata",f(this).attr({kind:d})}}).bind("load error",function(a){a.originalEvent&&
a.stopImmediatePropagation()})}});d.each(function(){var a=this,b=e.data(a,"mediaelementBase");if(b)clearTimeout(b.updateTrackListTimer),b.updateTrackListTimer=setTimeout(function(){j.call(a,b)},9)})});Modernizr.track&&f("video, audio").trigger("trackapichange")});
