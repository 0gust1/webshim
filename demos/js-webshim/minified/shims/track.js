jQuery.webshims.register("track",function(f,e,p,q){var h=e.mediaelement;(new Date).getTime();var u={subtitles:1,captions:1},r=function(){e.error("not implemented yet")},i=function(a){var c={};a.addEventListener=function(d,a){c[d]&&e.error("always use $.bind to the shimed event: "+d+" already bound fn was: "+c[d]+" your fn was: "+a);c[d]=a};a.removeEventListener=function(a,g){c[a]&&c[a]!=g&&e.error("always use $.unbind to the shimed event: "+a+" already bound fn was: "+c[a]+" your fn was: "+g);c[a]&&
delete c[a]};return a},v={getCueById:r},w={shimActiveCues:null,_shimActiveCues:null,activeCues:null,cues:null,kind:"subtitles",label:"",language:"",mode:0,readyState:0,oncuechange:null,toString:function(){return"[object TextTrack]"},addCue:function(a){if(!this.cues)this.cues=[];a.track&&e.error("cue already part of a track element");a.track=this;this.cues.push(a)},removeCue:r,DISABLED:0,OFF:0,HIDDEN:1,SHOWING:2,ERROR:3,LOADED:2,LOADING:1,NONE:0},x=["kind","label","srclang"],y=Function.prototype.call.bind(Object.prototype.hasOwnProperty),
n=function(){var a=f.prop(this,"textTracks"),c=e.data(this,"mediaelementBase"),d=a.splice(0),g,b;f("track",this).each(function(){a.push(f.prop(this,"track"))});if(c.scriptedTextTracks)for(g=0,b=c.scriptedTextTracks.length;g<b;g++)a.push(c.scriptedTextTracks[g]);if(h.trackDisplay&&c.trackDisplay)for(g=0,b=d.length;g<b;g++)-1==a.indexOf(d[g])&&h.trackDisplay.hide(d[g],c)},s=function(a,c){var d;c||(c=e.data(a,"trackData"));if(c&&!c.isTriggering)c.isTriggering=!0,d=(c.track||{}).mode,setTimeout(function(){if(d!==
(c.track||{}).mode)(c.track||{}).readyState?f(a).parent().triggerHandler("updatetrackdisplay"):f(a).triggerHandler("checktrackmode");c.isTriggering=!1},9)},o=f("<div />")[0];p.TextTrackCue=function(a,c,d){3!=arguments.length&&e.error("wrong arguments.length for TextTrackCue.constructor");this.startTime=a;this.endTime=c;this.text=d;this.id="";this.pauseOnExit=!1;i(this)};p.TextTrackCue.prototype={onenter:null,onexit:null,pauseOnExit:!1,getCueAsHTML:function(){var a="",c="",d=q.createDocumentFragment(),
g;if(!y(this,"getCueAsHTML"))g=this.getCueAsHTML=function(){var b,t;if(a!=this.text){a=this.text;c=h.parseCueTextToHTML(a);o.innerHTML=c;for(b=0,t=o.childNodes.length;b<t;b++)d.appendChild(o.childNodes[b].cloneNode(!0))}return d.cloneNode(!0)};return g?g.apply(this,arguments):d.cloneNode(!0)},track:null,id:""};h.createCueList=function(){return f.extend([],v)};h.parseCueTextToHTML=function(){var a=/(<\/?[^>]+>)/ig,c=/^(?:c|v|ruby|rt|b|i|u)/,d=/\<\s*\//,g=function(a,c,b,g){d.test(g)?a="</"+a+">":(b.splice(0,
1),a="<"+a+" "+c+'="'+b.join(" ").replace(/\"/g,"&quot;")+'">');return a},b=function(a){var b=a.replace(/[<\/>]+/ig,"").split(/[\s\.]+/);b[0]&&(b[0]=b[0].toLowerCase(),c.test(b[0])?"c"==b[0]?(b.splice(0,1),a=g("span","class",b,a)):"v"==b[0]&&(a=g("q","title",b,a)):a="");return a};return function(c){return c.replace(a,b)}}();h.createTextTrack=function(a,c){var d,g,b;if(c.nodeName&&(g=e.data(c,"trackData")))s(c,g),d=g.track;if(!d)if(d=i(e.objectCreate(w)),x.forEach(function(a){var b=f.prop(c,a);b&&
("srclang"==a&&(a="language"),d[a]=b)}),c.nodeName){if(b=function(){var g,l;if(d.mode&&(f(a).unbind("play playing timeupdate updatetrackdisplay",b),f(c).unbind("checktrackmode",b),!d.readyState)){g=function(){d.readyState=3;f(c).triggerHandler("error")};d.readyState=1;try{l=f.ajax({dataType:"text",url:f.prop(c,"src"),success:function(b){"text/vtt"!=l.getResponseHeader("content-type")&&e.warn("set the mime-type of your WebVTT files to text/vtt. see: http://dev.w3.org/html5/webvtt/#text/vtt");h.parseCaptions(b,
d,function(b){b&&"length"in b?(d.cues=b,d.activeCues=d.shimActiveCues=d._shimActiveCues=h.createCueList(),d.readyState=2,f(c).triggerHandler("load"),f(a).triggerHandler("updatetrackdisplay")):g()})},error:g})}catch(m){g(),e.warn(m)}}},g=e.data(c,"trackData",{track:d}),f(a).bind("play playing timeupdate updatetrackdisplay",b),f(c).bind("checktrackmode",b),f.prop(c,"default"))d.mode=u[d.kind]?2:1,b()}else d.cues=h.createCueList(),d.activeCues=d._shimActiveCues=d.shimActiveCues=h.createCueList(),d.mode=
1,d.readyState=2;return d};h.parseCaptionChunk=function(){var a=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,c=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g,d=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g,g=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g;return function(b){var f,e,h,k;if(c.exec(b)||d.exec(b)||g.exec(b))return null;for(b=b.split(/\n/g);!b[0].replace(/\s+/ig,"").length&&0<b.length;)b.shift();for(b[0].match(/^\s*[a-z0-9]+\s*$/ig)&&(h=""+b.shift().replace(/\s*/ig,
""));0<b.length;){if(k=a.exec(b[0]))e=k.slice(1),f=parseInt(3600*(e[0]||0),10)+parseInt(60*(e[1]||0),10)+parseInt(e[2]||0,10)+parseFloat("0."+(e[3]||0)),e=parseInt(3600*(e[4]||0),10)+parseInt(60*(e[5]||0),10)+parseInt(e[6]||0,10)+parseFloat("0."+(e[7]||0));b=b.slice(0,0).concat(b.slice(1));break}if(!f&&!e)return null;b=b.join("\n");f=new TextTrackCue(f,e,b);if(h)f.id=h;return f}}();h.parseCaptions=function(a,c,d){var g=h.createCueList(),b,f,l,m,k;if(a)l=/^WEBVTT(\s*FILE)?/ig,f=function(j,i){for(;j<
i;j++){b=a[j];if(l.test(b))k=!0;else if(b.replace(/\s*/ig,"").length){if(!k){e.error("please use WebVTT format. This is the standard");d(null);break}if(b=h.parseCaptionChunk(b,j))b.track=c,g.push(b)}if(m<(new Date).getTime()-9){j++;setTimeout(function(){m=(new Date).getTime();f(j,i)},90);break}}j>=i&&(k||e.error("please use WebVTT format. This is the standard"),d(g))},a=a.replace(/\r\n/g,"\n"),setTimeout(function(){a=a.replace(/\r/g,"\n");setTimeout(function(){m=(new Date).getTime();a=a.split(/\n\n+/g);
f(0,a.length)},9)},9);else throw Error("Required parameter captionData not supplied.");};h.createTrackList=function(a){a=e.data(a,"mediaelementBase")||e.data(a,"mediaelementBase",{});if(!a.textTracks)a.textTracks=[],e.defineProperties(a.textTracks,{onaddtrack:{value:null}}),i(a.textTracks);return a.textTracks};Modernizr.track||(e.defineNodeNamesBooleanProperty(["track"],"default"),e.reflectProperties(["track"],["srclang","label"]),e.defineNodeNameProperties("track",{kind:{reflect:!0,propType:"enumarated",
defaultValue:"subtitles",limitedTo:["subtitles","captions","descriptions","chapters","metadata"]},src:{reflect:!0,propType:"src"}}));e.defineNodeNamesProperties(["track"],{ERROR:{value:3},LOADED:{value:2},LOADING:{value:1},NONE:{value:0},readyState:{get:function(){return(f.prop(this,"track")||{readyState:0}).readyState},writeable:!1},track:{get:function(){return h.createTextTrack(f(this).closest("audio, video")[0],this)},writeable:!1}},"prop");e.defineNodeNamesProperties(["audio","video"],{textTracks:{get:function(){f("track",
this).each(function(){s(this)});return h.createTrackList(this)},writeable:!1},addTextTrack:{value:function(a,c,d){a=h.createTextTrack(this,{kind:a||"",label:c||"",srclang:d||""});c=e.data(this,"mediaelementBase")||e.data(this,"mediaelementBase",{});if(!c.scriptedTextTracks)c.scriptedTextTracks=[];c.scriptedTextTracks.push(a);n.call(this);return a}}},"prop");f(q).bind("emptied",function(a){f(a.target).is("audio, video")&&setTimeout(function(){n.call(a.target)},9)});e.addReady(function(a,c){f("video, audio",
a).add(c.filter("video, audio, track").closest("audio, video")).each(n).each(function(){if(Modernizr.track){var a=this.textTracks;f.prop(this,"textTracks").length!=a.length&&e.error("textTracks couldn't be copied");f("track",this).each(function(){var a=f.prop(this,"track"),b=this.track,c;if(b){c=b.readyState||this.readyState;if(b.mode||c)a.mode=b.mode;b.mode=0}}).bind("load error",function(a){if(a.originalEvent)a.stopImmediatePropagation(),this.track.mode=0})}})});Modernizr.track&&f("video, audio").trigger("trackapichange")});
