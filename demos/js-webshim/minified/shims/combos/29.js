webshims.register("track",function(a,b,c,d){"use strict";var e=b.mediaelement;(new Date).getTime();var f=a.fn.addBack?"addBack":"andSelf",g={subtitles:1,captions:1,descriptions:1},h=a("<track />"),i=Modernizr.ES5&&Modernizr.objectAccessor,j=function(a){var c={};return a.addEventListener=function(a,d){c[a]&&b.error("always use $.on to the shimed event: "+a+" already bound fn was: "+c[a]+" your fn was: "+d),c[a]=d},a.removeEventListener=function(a,d){c[a]&&c[a]!=d&&b.error("always use $.on/$.off to the shimed event: "+a+" already bound fn was: "+c[a]+" your fn was: "+d),c[a]&&delete c[a]},a},k={getCueById:function(a){for(var b=null,c=0,d=this.length;d>c;c++)if(this[c].id===a){b=this[c];break}return b}},l={0:"disabled",1:"hidden",2:"showing"},m={shimActiveCues:null,_shimActiveCues:null,activeCues:null,cues:null,kind:"subtitles",label:"",language:"",mode:"disabled",readyState:0,oncuechange:null,toString:function(){return"[object TextTrack]"},addCue:function(a){if(this.cues){var c=this.cues[this.cues.length-1];c&&c.startTime>a.startTime&&b.error("cue startTime higher than previous cue's startTime")}else this.cues=e.createCueList();a.track&&a.track.removeCue&&a.track.removeCue(a),a.track=this,this.cues.push(a)},removeCue:function(a){var c=this.cues||[],d=0,e=c.length;if(a.track!=this)return b.error("cue not part of track"),void 0;for(;e>d;d++)if(c[d]===a){c.splice(d,1),a.track=null;break}return a.track?(b.error("cue not part of track"),void 0):void 0},DISABLED:"disabled",OFF:"disabled",HIDDEN:"hidden",SHOWING:"showing",ERROR:3,LOADED:2,LOADING:1,NONE:0},n=["kind","label","srclang"],o={srclang:"language"},p=Function.prototype.call.bind(Object.prototype.hasOwnProperty),q=function(c,d){var e,f,g=[],h=[],i=[];if(c||(c=b.data(this,"mediaelementBase")||b.data(this,"mediaelementBase",{})),d||(c.blockTrackListUpdate=!0,d=a.prop(this,"textTracks"),c.blockTrackListUpdate=!1),clearTimeout(c.updateTrackListTimer),a("track",this).each(function(){var b=a.prop(this,"track");i.push(b),-1==d.indexOf(b)&&h.push(b)}),c.scriptedTextTracks)for(e=0,f=c.scriptedTextTracks.length;f>e;e++)i.push(c.scriptedTextTracks[e]),-1==d.indexOf(c.scriptedTextTracks[e])&&h.push(c.scriptedTextTracks[e]);for(e=0,f=d.length;f>e;e++)-1==i.indexOf(d[e])&&g.push(d[e]);if(g.length||h.length){for(d.splice(0),e=0,f=i.length;f>e;e++)d.push(i[e]);for(e=0,f=g.length;f>e;e++)a([d]).triggerHandler(a.Event({type:"removetrack",track:g[e]}));for(e=0,f=h.length;f>e;e++)a([d]).triggerHandler(a.Event({type:"addtrack",track:h[e]}));(c.scriptedTextTracks||g.length)&&a(this).triggerHandler("updatetrackdisplay")}},r=function(c,d){d||(d=b.data(c,"trackData")),d&&!d.isTriggering&&(d.isTriggering=!0,setTimeout(function(){(d.track||{}).readyState?a(c).closest("audio, video").triggerHandler("updatetrackdisplay"):a(c).triggerHandler("checktrackmode"),d.isTriggering=!1},1))},s=a("<div />")[0];c.TextTrackCue=function(a,c,d){3!=arguments.length&&b.error("wrong arguments.length for TextTrackCue.constructor"),this.startTime=a,this.endTime=c,this.text=d,this.id="",this.pauseOnExit=!1,j(this)},c.TextTrackCue.prototype={onenter:null,onexit:null,pauseOnExit:!1,getCueAsHTML:function(){var a,b="",c="",f=d.createDocumentFragment();return p(this,"getCueAsHTML")||(a=this.getCueAsHTML=function(){var a,d;if(b!=this.text)for(b=this.text,c=e.parseCueTextToHTML(b),s.innerHTML=c,a=0,d=s.childNodes.length;d>a;a++)f.appendChild(s.childNodes[a].cloneNode(!0));return f.cloneNode(!0)}),a?a.apply(this,arguments):f.cloneNode(!0)},track:null,id:""},e.createCueList=function(){return a.extend([],k)},e.parseCueTextToHTML=function(){var a=/(<\/?[^>]+>)/gi,b=/^(?:c|v|ruby|rt|b|i|u)/,c=/\<\s*\//,d=function(a,b,d,e){var f;return c.test(e)?f="</"+a+">":(d.splice(0,1),f="<"+a+" "+b+'="'+d.join(" ").replace(/\"/g,"&#34;")+'">'),f},e=function(a){var c=a.replace(/[<\/>]+/gi,"").split(/[\s\.]+/);return c[0]&&(c[0]=c[0].toLowerCase(),b.test(c[0])?"c"==c[0]?a=d("span","class",c,a):"v"==c[0]&&(a=d("q","title",c,a)):a=""),a};return function(b){return b.replace(a,e)}}(),e.loadTextTrack=function(c,d,f,h){var i="play playing timeupdate updatetrackdisplay",j=f.track,k=function(){var f,g,h=a.prop(d,"src");if("disabled"!=j.mode&&h&&a.attr(d,"src")&&(a(c).unbind(i,k),a(d).unbind("checktrackmode",k),!j.readyState)){f=function(){j.readyState=3,j.cues=null,j.activeCues=j.shimActiveCues=j._shimActiveCues=null,a(d).triggerHandler("error")},j.readyState=1;try{j.cues=e.createCueList(),j.activeCues=j.shimActiveCues=j._shimActiveCues=e.createCueList(),g=a.ajax({dataType:"text",url:h,success:function(h){"text/vtt"!=g.getResponseHeader("content-type")&&b.error("set the mime-type of your WebVTT files to text/vtt. see: http://dev.w3.org/html5/webvtt/#text/vtt"),e.parseCaptions(h,j,function(b){b&&"length"in b?(j.readyState=2,a(d).triggerHandler("load"),a(c).triggerHandler("updatetrackdisplay")):f()})},error:f})}catch(l){f(),b.warn(l)}}};j.readyState=0,j.shimActiveCues=null,j._shimActiveCues=null,j.activeCues=null,j.cues=null,a(c).unbind(i,k),a(d).unbind("checktrackmode",k),a(c).on(i,k),a(d).on("checktrackmode",k),h&&(j.mode=g[j.kind]?"showing":"hidden",k())},e.createTextTrack=function(c,d){var g,h;return d.nodeName&&(h=b.data(d,"trackData"),h&&(r(d,h),g=h.track)),g||(g=j(b.objectCreate(m)),i||n.forEach(function(b){var c=a.prop(d,b);c&&(g[o[b]||b]=c)}),d.nodeName?(i&&n.forEach(function(c){b.defineProperty(g,o[c]||c,{get:function(){return a.prop(d,c)}})}),h=b.data(d,"trackData",{track:g}),e.loadTextTrack(c,d,h,a.prop(d,"default")&&a(d).siblings("track[default]")[f]()[0]==d)):(i&&n.forEach(function(a){b.defineProperty(g,o[a]||a,{value:d[a],writeable:!1})}),g.cues=e.createCueList(),g.activeCues=g._shimActiveCues=g.shimActiveCues=e.createCueList(),g.mode="hidden",g.readyState=2)),g},e.parseCaptionChunk=function(){var a=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,c=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g,d=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g,e=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g;return function(f){var g,h,i,j,k,l,m,n,o,p;if(n=c.exec(f))return null;if(n=d.exec(f))return null;if(n=e.exec(f))return null;for(g=f.split(/\n/g);!g[0].replace(/\s+/gi,"").length&&g.length>0;)g.shift();for(g[0].match(/^\s*[a-z0-9-\_]+\s*$/gi)&&(m=String(g.shift().replace(/\s*/gi,""))),l=0;l<g.length;l++){var q=g[l];(o=a.exec(q))&&(k=o.slice(1),h=parseInt(60*60*(k[0]||0),10)+parseInt(60*(k[1]||0),10)+parseInt(k[2]||0,10)+parseFloat("0."+(k[3]||0)),i=parseInt(60*60*(k[4]||0),10)+parseInt(60*(k[5]||0),10)+parseInt(k[6]||0,10)+parseFloat("0."+(k[7]||0))),g=g.slice(0,l).concat(g.slice(l+1));break}return h||i?(j=g.join("\n"),p=new TextTrackCue(h,i,j),m&&(p.id=m),p):(b.warn("couldn't extract time information: "+[h,i,g.join("\n"),m].join(" ; ")),null)}}(),e.parseCaptions=function(a,c,d){e.createCueList();var f,g,h,i,j;a?(h=/^WEBVTT(\s*FILE)?/gi,g=function(k,l){for(;l>k;k++){if(f=a[k],h.test(f))j=!0;else if(f.replace(/\s*/gi,"").length){if(!j){b.error("please use WebVTT format. This is the standard"),d(null);break}f=e.parseCaptionChunk(f,k),f&&c.addCue(f)}if(i<(new Date).getTime()-30){k++,setTimeout(function(){i=(new Date).getTime(),g(k,l)},90);break}}k>=l&&(j||b.error("please use WebVTT format. This is the standard"),d(c.cues))},a=a.replace(/\r\n/g,"\n"),setTimeout(function(){a=a.replace(/\r/g,"\n"),setTimeout(function(){i=(new Date).getTime(),a=a.split(/\n\n+/g),g(0,a.length)},9)},9)):b.error("Required parameter captionData not supplied.")},e.createTrackList=function(a,c){return c=c||b.data(a,"mediaelementBase")||b.data(a,"mediaelementBase",{}),c.textTracks||(c.textTracks=[],b.defineProperties(c.textTracks,{onaddtrack:{value:null},onremovetrack:{value:null}}),j(c.textTracks)),c.textTracks},Modernizr.track||(b.defineNodeNamesBooleanProperty(["track"],"default"),b.reflectProperties(["track"],["srclang","label"]),b.defineNodeNameProperties("track",{src:{reflect:!0,propType:"src"}})),b.defineNodeNameProperties("track",{kind:{attr:Modernizr.track?{set:function(a){var c=b.data(this,"trackData");this.setAttribute("data-kind",a),c&&(c.attrKind=a)},get:function(){var a=b.data(this,"trackData");return a&&"attrKind"in a?a.attrKind:this.getAttribute("kind")}}:{},reflect:!0,propType:"enumarated",defaultValue:"subtitles",limitedTo:["subtitles","captions","descriptions","chapters","metadata"]}}),a.each(n,function(c,d){var e=o[d]||d;b.onNodeNamesPropertyModify("track",d,function(){var c=b.data(this,"trackData"),f=this;c&&("kind"==d&&r(this,c),i||(c.track[e]=a.prop(this,d)),clearTimeout(c.changedTrackPropTimer),c.changedTrackPropTimer=setTimeout(function(){a(f).trigger("updatesubtitlestate")},1))})}),b.onNodeNamesPropertyModify("track","src",function(c){if(c){var d,f=b.data(this,"trackData");f&&(d=a(this).closest("video, audio"),d[0]&&e.loadTextTrack(d,this,f))}}),b.defineNodeNamesProperties(["track"],{ERROR:{value:3},LOADED:{value:2},LOADING:{value:1},NONE:{value:0},readyState:{get:function(){return(a.prop(this,"track")||{readyState:0}).readyState},writeable:!1},track:{get:function(){return e.createTextTrack(a(this).closest("audio, video")[0],this)},writeable:!1}},"prop"),b.defineNodeNamesProperties(["audio","video"],{textTracks:{get:function(){var a=this,c=b.data(a,"mediaelementBase")||b.data(a,"mediaelementBase",{}),d=e.createTrackList(a,c);return c.blockTrackListUpdate||q.call(a,c,d),d},writeable:!1},addTextTrack:{value:function(a,c,d){var f=e.createTextTrack(this,{kind:h.prop("kind",a||"").prop("kind"),label:c||"",srclang:d||""}),g=b.data(this,"mediaelementBase")||b.data(this,"mediaelementBase",{});return g.scriptedTextTracks||(g.scriptedTextTracks=[]),g.scriptedTextTracks.push(f),q.call(this),f}}},"prop"),a(d).on("emptied ended updatetracklist",function(c){if(a(c.target).is("audio, video")){var d=b.data(c.target,"mediaelementBase");d&&(clearTimeout(d.updateTrackListTimer),d.updateTrackListTimer=setTimeout(function(){q.call(c.target,d)},0))}});var t=function(a,b){return b.readyState||a.readyState},u=function(a){a.originalEvent&&a.stopImmediatePropagation()},v=function(){if(b.implement(this,"track")){var c,d,e=a.prop(this,"track"),f=this.track;f&&(c=a.prop(this,"kind"),d=t(this,f),(f.mode||d)&&(e.mode=l[f.mode]||f.mode),"descriptions"!=c&&(f.mode="string"==typeof f.mode?"disabled":0,this.kind="metadata",a(this).attr({kind:c}))),a(this).on("load error",u)}};b.addReady(function(c,d){var e=d.filter("video, audio, track").closest("audio, video");a("video, audio",c).add(e).each(function(){q.call(this)}).each(function(){if(Modernizr.track){var c=a.prop(this,"textTracks"),d=this.textTracks;c.length!=d.length&&b.error("textTracks couldn't be copied"),a("track",this).each(v)}}),e.each(function(){var a=this,c=b.data(a,"mediaelementBase");c&&(clearTimeout(c.updateTrackListTimer),c.updateTrackListTimer=setTimeout(function(){q.call(a,c)},9))})}),Modernizr.track&&a("video, audio").trigger("trackapichange")}),function(a){if(Modernizr.track&&Modernizr.texttrackapi&&document.addEventListener){var b=webshims.cfg.track,c=function(b){a(b.target).filter("track").each(e)},d=webshims.bugs.track,e=function(){return d||!b.override&&3==a.prop(this,"readyState")?(b.override=!0,webshims.reTest("track"),document.removeEventListener("error",c,!0),this&&a.nodeName(this,"track")?webshims.error("track support was overwritten. Please check your vtt including your vtt mime-type"):webshims.info("track support was overwritten. due to bad browser support"),!1):void 0},f=function(){document.addEventListener("error",c,!0),d?e():a("track").each(e)};b.override||f()}}(webshims.$),webshims.register("track-ui",function(a,b){"use strict";function c(a,b){var c=!0,d=0,e=a.length;if(e!=b.length)c=!1;else for(;e>d;d++)if(a[d]!=b[d]){c=!1;break}return c}var d=b.cfg.track,e={subtitles:1,captions:1,descriptions:1},f=b.mediaelement,g=function(){return!d.override&&Modernizr.texttrackapi},h={update:function(d,e){d.activeCues.length?c(d.displayedActiveCues,d.activeCues)||(d.displayedActiveCues=d.activeCues,d.trackDisplay||(d.trackDisplay=a('<div class="cue-display"><span class="description-cues" aria-live="assertive" /></div>').insertAfter(e),this.addEvents(d,e),b.docObserve()),d.hasDirtyTrackDisplay&&e.triggerHandler("forceupdatetrackdisplay"),this.showCues(d)):this.hide(d)},showCues:function(b){var c=a('<span class="cue-wrapper" />');a.each(b.displayedActiveCues,function(d,e){var f=e.id?'id="cue-id-'+e.id+'"':"",g=a('<span class="cue-line"><span '+f+' class="cue" /></span>').find("span").html(e.getCueAsHTML()).end();"descriptions"==e.track.kind?setTimeout(function(){a("span.description-cues",b.trackDisplay).html(g)},0):c.prepend(g)}),a("span.cue-wrapper",b.trackDisplay).remove(),b.trackDisplay.append(c)},addEvents:function(a,b){if(d.positionDisplay){var c,e=function(c){if(a.displayedActiveCues.length||c===!0){a.trackDisplay.css({display:"none"});var d=b.getShadowElement();d.offsetParent();var e=d.innerHeight(),f=d.innerWidth(),g=d.position();a.trackDisplay.css({left:g.left,width:f,height:e-45,top:g.top,display:"block"}),a.trackDisplay.css("fontSize",Math.max(Math.round(e/30),7)),a.hasDirtyTrackDisplay=!1}else a.hasDirtyTrackDisplay=!0},f=function(){clearTimeout(c),c=setTimeout(e,0)},g=function(){e(!0)};b.on("playerdimensionchange mediaelementapichange updatetrackdisplay updatemediaelementdimensions swfstageresize",f),b.on("forceupdatetrackdisplay",g).onWSOff("updateshadowdom",f),g()}},hide:function(b){b.trackDisplay&&b.displayedActiveCues.length&&(b.displayedActiveCues=[],a("span.cue-wrapper",b.trackDisplay).remove(),a("span.description-cues",b.trackDisplay).empty())}};if(f.trackDisplay=h,!f.createCueList){var i={getCueById:function(a){for(var b=null,c=0,d=this.length;d>c;c++)if(this[c].id===a){b=this[c];break}return b}};f.createCueList=function(){return a.extend([],i)}}f.getActiveCue=function(b,c,g,h){b._lastFoundCue||(b._lastFoundCue={index:0,time:0}),!Modernizr.texttrackapi||d.override||b._shimActiveCues||(b._shimActiveCues=f.createCueList());for(var i,j,k=0;k<b.shimActiveCues.length;k++)j=b.shimActiveCues[k],j.startTime>g||j.endTime<g?(b.shimActiveCues.splice(k,1),k--,j.pauseOnExit&&a(c).pause(),a(b).triggerHandler("cuechange"),a(j).triggerHandler("exit")):"showing"==b.mode&&e[b.kind]&&-1==a.inArray(j,h.activeCues)&&h.activeCues.push(j);for(i=b.cues.length,k=b._lastFoundCue.time<g?b._lastFoundCue.index:0;i>k&&(j=b.cues[k],j.startTime<=g&&j.endTime>=g&&-1==a.inArray(j,b.shimActiveCues)&&(b.shimActiveCues.push(j),"showing"==b.mode&&e[b.kind]&&h.activeCues.push(j),a(b).triggerHandler("cuechange"),a(j).triggerHandler("enter"),b._lastFoundCue.time=g,b._lastFoundCue.index=k),!(j.startTime>g));k++);},g()&&(!function(){var c,d=function(b){setTimeout(function(){c=!0,a(b).triggerHandler("updatetrackdisplay"),c=!1},9)},e=function(e,f,h){var i,j="_sup"+h,k={prop:{}};k.prop[h]=function(){return!c&&g()&&d(a(this).closest("audio, video")),i.prop[j].apply(this,arguments)},i=b.defineNodeNameProperty(e,f,k)};e("track","track","get"),["audio","video"].forEach(function(a){e(a,"textTracks","get"),e("nodeName","addTextTrack","value")})}(),a.propHooks.activeCues={get:function(a){return a._shimActiveCues||a.activeCues}}),b.addReady(function(c,d){a("video, audio",c).add(d.filter("video, audio")).filter(function(){return b.implement(this,"trackui")}).each(function(){var c,d,e,i,j=a(this),k=function(){var a,e;if(d&&c||(d=j.prop("textTracks"),c=b.data(j[0],"mediaelementBase")||b.data(j[0],"mediaelementBase",{}),c.displayedActiveCues||(c.displayedActiveCues=[])),d&&(e=j.prop("currentTime"),e||0===e)){c.activeCues=[];for(var g=0,i=d.length;i>g;g++)a=d[g],"disabled"!=a.mode&&a.cues&&a.cues.length&&f.getActiveCue(a,j,e,c);h.update(c,j)}},l=function(a){clearTimeout(e),a&&"timeupdate"==a.type?(k(),i=setTimeout(l,90)):e=setTimeout(k,9)},m=function(){j.off(".trackview").on("play.trackview timeupdate.trackview updatetrackdisplay.trackview",l)};j.on("remove",function(a){!a.originalEvent&&c&&c.trackDisplay&&setTimeout(function(){c.trackDisplay.remove()},4)}),g()?j.on("mediaelementapichange trackapichange",function(){!g()||j.is(".nonnative-api-active")?m():(clearTimeout(e),clearTimeout(i),d=j.prop("textTracks"),c=b.data(j[0],"mediaelementBase")||b.data(j[0],"mediaelementBase",{}),a.each(d,function(a,b){b._shimActiveCues&&delete b._shimActiveCues}),h.hide(c),j.unbind(".trackview"))}):m()})})});