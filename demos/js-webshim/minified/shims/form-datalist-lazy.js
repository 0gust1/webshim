webshims.register("form-datalist-lazy",function(a,b,c,d,e,f){var g=0,h=a.webshims.cfg.forms,i={},j=function(a){if(!a)return[];if(i[a])return i[a];var b;try{b=JSON.parse(localStorage.getItem("storedDatalistOptions"+a))}catch(c){}return i[a]=b||[],b||[]},k=function(a,b){if(a){b=b||[];try{localStorage.setItem("storedDatalistOptions"+a,JSON.stringify(b))}catch(c){}}},l=/</g,m=/>/g,n=/\s*,\s*/g;a.extend(f.shadowListProto,{_lazyCreate:function(d){var e=this;this.hideList=a.proxy(e,"hideList"),this.popover=b.objectCreate(b.wsPopover,{},f.datalistPopover),this.shadowList=this.popover.element.addClass("datalist-polyfill"),this.index=-1,this.input=d.input,this.arrayOptions=[],this.shadowList.delegate("li","mouseenter.datalistWidget mousedown.datalistWidget click.datalistWidget",function(b){var c=a("li:not(.hidden-item)",e.shadowList),f="mousedown"==b.type||"click"==b.type;return e.markItem(c.index(b.currentTarget),f,c),"click"==b.type&&(e.hideList(),h.customDatalist&&a(d.input).getNativeElement().trigger("datalistselect")),"mousedown"!=b.type}),d.input.setAttribute("autocomplete","off"),a(d.input).attr({"aria-haspopup":"true"}).on({"input.datalistWidget":function(){e.triggeredByDatalist||(e.changedValue=!1,e.showHideOptions())},"keydown.datalistWidget":function(b){var c,f,g=b.keyCode;return 40!=g||e.showList()?e.popover.isVisible?38==g?(e.markItem(e.index-1,!0),!1):b.shiftKey||33!=g&&36!=g?b.shiftKey||34!=g&&35!=g?(13==g||27==g)&&(13==g&&(c=a("li.active-item:not(.hidden-item)",e.shadowList),e.changeValue(a("li.active-item:not(.hidden-item)",e.shadowList))),e.hideList(),h.customDatalist&&c&&c[0]&&a(d.input).getNativeElement().trigger("datalistselect"),13!=b.keyCode||c&&c[0])?!1:void 0:(f=a("li:not(.hidden-item)",e.shadowList),e.markItem(f.length-1,!0,f),!1):(e.markItem(0,!0),!1):void 0:(e.markItem(e.index+1,!0),!1)},"focus.datalistWidget":function(){a(this).hasClass("list-focus")&&e.showList()},"mousedown.datalistWidget":function(){a(this).is(":focus")&&e.showList()}}),a(this.datalist).off("updateDatalist.datalistWidget").on("updateDatalist.datalistWidget",a.proxy(this,"_resetListCached")).on("remove",function(a){a.originalEvent||e.detroy()}),this._resetListCached(),d.input.form&&(d.input.name||d.input.id)&&a(d.input.form).on("submit.datalistWidget"+d.input.id,function(){if(!a(d.input).hasClass("no-datalist-cache")&&"off"!=e._autocomplete){var b=a.prop(d.input,"value"),c=(d.input.name||d.input.id)+a.prop(d.input,"type");e.storedOptions||(e.storedOptions=j(c)),b&&-1==e.storedOptions.indexOf(b)&&(e.storedOptions.push(b),k(c,e.storedOptions))}}),a(c).on("unload.datalist"+this.id+" beforeunload.datalist"+this.id,function(a){e.destroy(a)})},_resetListCached:function(){var b,d=this;this.needsUpdate=!0,this.lastUpdatedValue=!1,this.lastUnfoundValue="",this.updateTimer||(c.QUnit||(b=a(d.input).is(":focus")&&(a(d.input).hasClass("list-focus")||a.prop(d.input,"value")))?d.updateListOptions(b):d.updateTimer=setTimeout(function(){d.updateListOptions(),d=null,g=1},200+100*g))},updateListOptions:function(c){this.needsUpdate=!1,clearTimeout(this.updateTimer),this.updateTimer=!1,(a(this.input).hasClass("ws-nosearch")||a(this.input).hasClass("search-start"))&&b.error('please use listFilter/data-list-filer configuration with values: "*", "^" or "!"'),this.addMarkElement=f.addMark||a(this.input).hasClass("mark-option-text"),this.listFilter=a(this.input).data("listFilter")||f.listFilter||"*",this.multiple=a(this.input).hasClass("list-multiple")||a(this.input).prop("multiple")&&"email"==a(this.input).prop("type");var d,e,g,h,i,k,n,o=[],p=[],q=[];for(g=a.prop(this.datalist,"options"),h=0,i=g.length;i>h;h++)d=g[h],!d.disabled&&(n=a(d).val())&&(e={value:n.replace(l,"&lt;").replace(m,"&gt;"),label:a.trim(a.attr(d,"label"))||"",className:d.className||"",elem:f.getOptionContent?d:null},e.label&&(e.className+=" has-option-label"),p.push(e.value),q.push(e));for(this.storedOptions||(this.storedOptions=a(this.input).hasClass("no-datalist-cache")||"off"==this._autocomplete?[]:j((this.input.name||this.input.id)+a.prop(this.input,"type"))),this.storedOptions.forEach(function(a){-1==p.indexOf(a)&&q.push({value:a,label:"",className:"stored-suggest",style:""})}),h=0,i=q.length;i>h;h++)k=q[h],o[h]='<li class="'+k.className+'" tabindex="-1" role="listitem">'+this.getOptionContent(k)+"</li>";this.arrayOptions=q,this.popover.contentElement.html('<div class="datalist-box"><ul role="list">'+o.join("\n")+"</ul></div>"),f.datalistCreated&&f.datalistCreated.apply(this),(c||this.popover.isVisible)&&this.showHideOptions()},getOptionContent:function(a){var b;return f.getOptionContent&&(b=f.getOptionContent.apply(this,arguments),null!=b&&(b+='<span class="option-value" style="display: none;">'+a.value+"</span>")),null==b&&(b='<span class="option-value">'+a.value+"</span>",a.label&&(b+=' <span class="option-label">'+a.label+"</span>")),b||""},showHideOptions:function(b){var c=a.prop(this.input,"value").toLowerCase();if(c!==this.lastUpdatedValue){if(this.multiple&&(c=c.split(n),c=c[c.length-1]||""),this.lastUnfoundValue&&0===c.indexOf(this.lastUnfoundValue))return this.hideList(),void 0;this.lastUpdatedValue=c;var d=!1,e="^"==this.listFilter,f=a("li",this.shadowList),g=this;c&&"!"!=this.listFilter?this.arrayOptions.forEach(function(b,h){var i,j,k;"lowerValue"in b||(b.lowerValue=b.value.toLowerCase(),b.label&&b.label!=b.value&&(b.lowerLabel=b.label.toLowerCase())),c!=b.lowerValue&&b.lowerLabel!=c&&(j=b.lowerValue.indexOf(c),i=e?!j:-1!==j,i?k="value":b.lowerLabel&&(j=b.lowerLabel.indexOf(c),i=e?!j:-1!==j,k="label")),i?(g.addMark(a(f[h]).removeClass("hidden-item"),b,k,j,c.length),d=!0):a(f[h]).addClass("hidden-item")}):f.length&&(this.removeMark(f.removeClass("hidden-item")),d=!0),this.hasViewableData=d,!b&&d&&(this.popover.isVisible&&"bottom"==this.popover.element.attr("data-vertical")&&this.popover.element.triggerHandler("pospopover"),this.showList()),d?this.lastUnfoundValue=!1:(this.lastUnfoundValue=c,this.hideList())}},otherType:{value:"label",label:"value"},addMark:function(b,c,d,e,f){if(this.addMarkElement){var g=c[d].substr(e,f);g=c[d].replace(g,"<mark>"+g+"</mark>"),a(".option-"+this.otherType[d]+" > mark",b).each(this._replaceMark),a(".option-"+d,b).html(g)}},_replaceMark:function(){var b=a(this).html();a(this).replaceWith(b)},removeMark:function(b){this.addMarkElement&&a("mark",b).each(this._replaceMark)},showList:function(){if(this.popover.isVisible)return!1;if(this.needsUpdate&&this.updateListOptions(),this.showHideOptions(!0),!this.hasViewableData)return!1;var a=this;return a.shadowList.find("li.active-item").removeClass("active-item"),a.popover.show(this.input),!0},hideList:function(){if(!this.popover.isVisible)return!1;var b=this;return this.popover.hide(),b.shadowList.removeClass("datalist-visible list-item-active"),b.index=-1,b.changedValue&&(b.triggeredByDatalist=!0,a(b.input).trigger("input").trigger("change"),b.changedValue=!1,b.triggeredByDatalist=!1),!0},scrollIntoView:function(b){var c,d=a("ul",this.shadowList),e=a("div.datalist-box",this.shadowList),f=b.position();return f.top-=(parseInt(d.css("paddingTop"),10)||0)+(parseInt(d.css("marginTop"),10)||0)+(parseInt(d.css("borderTopWidth"),10)||0),f.top<0?(e.scrollTop(e.scrollTop()+f.top-2),void 0):(f.top+=b.outerHeight(),c=e.height(),f.top>c&&e.scrollTop(e.scrollTop()+(f.top-c)+2),void 0)},changeValue:function(b){if(b[0]){var c,d,e=a("span.option-value",b).text(),f=a.prop(this.input,"value");this.multiple&&(d=f.split(n),d[d.length-1]=e,e=d.join(", ")),e!=f&&(a(this.input).prop("value",e).triggerHandler("updateInput"),this.changedValue=!0,(c=a.data(this.input,"wsspinner"))&&c.setInput&&c.setInput(e))}},markItem:function(b,c,d){var e;d=d||a("li:not(.hidden-item)",this.shadowList),d.length&&(0>b?b=d.length-1:b>=d.length&&(b=0),d.removeClass("active-item"),this.shadowList.addClass("list-item-active"),e=d.filter(":eq("+b+")").addClass("active-item"),c&&(this.changeValue(e),this.scrollIntoView(e)),this.index=b)}})});