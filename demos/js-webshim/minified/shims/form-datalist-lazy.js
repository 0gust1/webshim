webshims.register("form-datalist-lazy",function(e,t,i,n,a,r){var o=0,s=e.webshims.cfg.forms,l={},u=function(e){if(!e)return[];if(l[e])return l[e];var t;try{t=JSON.parse(localStorage.getItem("storedDatalistOptions"+e))}catch(i){}return l[e]=t||[],t||[]},c=function(e,t){if(e){t=t||[];try{localStorage.setItem("storedDatalistOptions"+e,JSON.stringify(t))}catch(i){}}},d=/</g,p=/>/g,f=/\s*,\s*/g;e.extend(r.shadowListProto,{_lazyCreate:function(n){var o=this;this.hideList=e.proxy(o,"hideList"),this._updateOptions(),this.popover=t.objectCreate(t.wsPopover,{},r.popover),this.shadowList=this.popover.element.addClass("datalist-polyfill"),this.index=-1,this.input=n.input,this.arrayOptions=[],this.shadowList.on("mouseenter.datalistWidget mousedown.datalistWidget click.datalistWidget","li",function(t){var i=e("li:not(.hidden-item)",o.shadowList),a="mousedown"==t.type||"click"==t.type;return o.markItem(i.index(t.currentTarget),a,i),"click"==t.type&&(o.hideList(),s.customDatalist&&e(n.input).getNativeElement().trigger("datalistselect")),"mousedown"!=t.type}),n.input.setAttribute("autocomplete","off"),this.lastCompletedValue="",e(n.input).attr({"aria-haspopup":"true"}).on({"input.datalistWidget":function(){o.triggeredByDatalist||(o.changedValue=!1,o.showHideOptions())},"keydown.datalistWidget":function(t){var i,r,l=t.keyCode;return 40!=l||o.showList()?o.popover.isVisible?38==l?(o.markItem(o.index-1,!0),!1):t.shiftKey||33!=l&&36!=l?t.shiftKey||34!=l&&35!=l?(13==l||27==l)&&(13==l&&(i=e("li.active-item:not(.hidden-item)",o.shadowList),o.changeValue(e("li.active-item:not(.hidden-item)",o.shadowList))),o.hideList(),s.customDatalist&&i&&i[0]&&e(n.input).getNativeElement().trigger("datalistselect"),13!=t.keyCode||i&&i[0])?!1:a:(r=e("li:not(.hidden-item)",o.shadowList),o.markItem(r.length-1,!0,r),!1):(o.markItem(0,!0),!1):a:(o.markItem(o.index+1,!0),!1)},"focus.datalistWidget":function(){o.lastCompletedValue="",o.options.focus&&o.showList()},"mousedown.datalistWidget":function(){e(this).is(":focus")&&o.showList()}}),e(this.datalist).off("updateDatalist.datalistWidget").on("updateDatalist.datalistWidget",e.proxy(this,"_resetListCached")).on("remove",function(e){e.originalEvent||o.detroy()}),this._resetListCached(),n.input.form&&(n.input.name||n.input.id)&&e(n.input.form).on("submit.datalistWidget"+n.input.id,function(){if(!e(n.input).hasClass("no-datalist-cache")&&"off"!=o._autocomplete){var t=e.prop(n.input,"value"),i=(n.input.name||n.input.id)+e.prop(n.input,"type");o.storedOptions||(o.storedOptions=u(i)),t&&-1==o.storedOptions.indexOf(t)&&(o.storedOptions.push(t),c(i,o.storedOptions))}}),e(i).on("unload.datalist"+this.id+" beforeunload.datalist"+this.id,function(e){o.destroy(e)})},_resetListCached:function(){var t,n=this;this.needsUpdate=!0,this.lastUpdatedValue=!1,this.lastUnfoundValue="",this.updateTimer||(i.QUnit||(t=e(n.input).is(":focus")&&(e(n.input).hasClass("list-focus")||e.prop(n.input,"value")))?n.updateListOptions(t):n.updateTimer=setTimeout(function(){n.updateListOptions(),n=null,o=1},200+100*o))},_updateOptions:function(){this.options=e.extend(!0,{},r.list,e(this.input).data("list")||{}),e(this.input).prop("multiple")&&"email"==e(this.input).prop("type")&&(this.options.multiple=!0),e(this.input).hasClass("list-focus")&&t.error(".list-focus is depreacated. Use focus option."),r.datalistPopover&&!this.options.popover&&(this.options.popover=r.datalistPopover,t.error("datalistPopover is depreacated. Use popover option.")),e(this.input).hasClass("mark-option-text")&&(this.options.highlight=!0,t.error(".mark-option-text is depreacated. Use highlight option.")),e(this.input).data("listFilter")&&(this.listFilter=e(this.input).data("listFilter"),t.error("[data-list-filter] is depreacated. Use filter option.")),e(this.input).hasClass("list-multiple")&&(this.options.multiple=!0,t.error(".list-multiple is depreacated. Use multiple option.")),e(this.input).hasClass("value-completion")&&(this.options.valueCompletion=!0,t.error(".value-completion is depreacated. Use valueCompletion option.")),this.options.valueCompletion&&this.options.multiple&&t.warn("valueCompletion and multiple shouldn't be set together")},updateListOptions:function(t){this.needsUpdate=!1,clearTimeout(this.updateTimer),this.updateTimer=!1,this._updateOptions(),this.lastCompletedValue="";var i,n,a,o,s,l,c,f=[],h=[],m=[];for(a=e.prop(this.datalist,"options"),o=0,s=a.length;s>o;o++)i=a[o],!i.disabled&&(c=e(i).val())&&(n={value:c.replace(d,"&lt;").replace(p,"&gt;"),label:e.trim(e.attr(i,"label"))||"",className:i.className||"",elem:r.getOptionContent?i:null},n.label&&(n.className+=" has-option-label"),h.push(n.value),m.push(n));for(this.storedOptions||(this.storedOptions=e(this.input).hasClass("no-datalist-cache")||"off"==this._autocomplete?[]:u((this.input.name||this.input.id)+e.prop(this.input,"type"))),this.storedOptions.forEach(function(e){-1==h.indexOf(e)&&m.push({value:e,label:"",className:"stored-suggest",style:""})}),o=0,s=m.length;s>o;o++)l=m[o],f[o]='<li class="'+l.className+'" tabindex="-1" role="listitem">'+this.getOptionContent(l)+"</li>";this.arrayOptions=m,this.popover.contentElement.html('<div class="datalist-box"><ul role="list">'+f.join("\n")+"</ul></div>"),r.datalistCreated&&r.datalistCreated.apply(this),(t||this.popover.isVisible)&&this.showHideOptions()},getOptionContent:function(e){var t;return r.getOptionContent&&(t=r.getOptionContent.apply(this,arguments),null!=t&&(t+='<span class="option-value" style="display: none;">'+e.value+"</span>")),null==t&&(t='<span class="option-value">'+e.value+"</span>",e.label&&(t+=' <span class="option-label">'+e.label+"</span>")),t||""},setCompletedValue:function(t,i){if(!this.options.valueCompletion||!i||this.lastCompletedValue.length>=t.length)return this.lastCompletedValue=t,a;var n,r=this.input,o=e.prop(r,"selectionEnd");this.lastCompletedValue=t,t.length==o&&(n=t+i.value.substr(t.length),e(r).triggerHandler("triggerinput"),e.prop(r,"value",n),e(r).triggerHandler("updateInput"),e(r).callProp("setSelectionRange",[t.length,n.length]),setTimeout(function(){n==e.prop(r,"value")&&e.prop(r,"selectionEnd")!=n.length&&e.prop(r,"selectionEnd",n.length)},0))},showHideOptions:function(t){var i,n,r=e.prop(this.input,"value"),o=r.toLowerCase(),s=!1,l="^"==this.options.filter,u=this;if(o!==this.lastUpdatedValue){if(this.options.multiple&&(o=o.split(f),o=o[o.length-1]||""),this.lastUnfoundValue&&0===o.indexOf(this.lastUnfoundValue))return this.hideList(),a;this.lastUpdatedValue=o,i=e("li",this.shadowList),o&&"!"!=this.options.filter?this.arrayOptions.forEach(function(t,a){var r,c,d;"lowerValue"in t||(t.lowerValue=t.value.toLowerCase(),t.label&&t.label!=t.value&&(t.lowerLabel=t.label.toLowerCase())),o!=t.lowerValue&&t.lowerLabel!=o&&(c=t.lowerValue.indexOf(o),r=l?!c:-1!==c,r?(d="value",n||c||(n=t)):t.lowerLabel&&(c=t.lowerLabel.indexOf(o),r=l?!c:-1!==c,d="label")),r?(u.addMark(e(i[a]).removeClass("hidden-item"),t,d,c,o.length),s=!0):e(i[a]).addClass("hidden-item")}):i.length&&(this.removeMark(i.removeClass("hidden-item")),s=!0),this.hasViewableData=s,!t&&s&&(this.popover.isVisible&&"bottom"==this.popover.element.attr("data-vertical")&&this.popover.element.triggerHandler("pospopover"),this.showList()),s?(this.setCompletedValue(r,n),this.lastUnfoundValue=!1):(this.lastUnfoundValue=o,this.hideList())}},otherType:{value:"label",label:"value"},addMark:function(t,i,n,a,r){if(this.options.highlight){var o=i[n].substr(a,r);o=i[n].replace(o,"<mark>"+o+"</mark>"),e(".option-"+this.otherType[n]+" > mark",t).each(this._replaceMark),e(".option-"+n,t).html(o)}},_replaceMark:function(){var t=e(this).html();e(this).replaceWith(t)},removeMark:function(t){this.options.highlight&&e("mark",t).each(this._replaceMark)},showList:function(){if(this.popover.isVisible)return!1;if(this.needsUpdate&&this.updateListOptions(),this.showHideOptions(!0),!this.hasViewableData)return!1;var e=this;return e.shadowList.find("li.active-item").removeClass("active-item"),e.popover.show(this.input),!0},hideList:function(){if(!this.popover.isVisible)return!1;var t=this;return this.popover.hide(),t.shadowList.removeClass("datalist-visible list-item-active"),t.index=-1,t.changedValue&&(t.triggeredByDatalist=!0,e(t.input).trigger("input").trigger("change"),t.changedValue=!1,t.triggeredByDatalist=!1),!0},scrollIntoView:function(t){var i,n=e("ul",this.shadowList),r=e("div.datalist-box",this.shadowList),o=t.position();return o.top-=(parseInt(n.css("paddingTop"),10)||0)+(parseInt(n.css("marginTop"),10)||0)+(parseInt(n.css("borderTopWidth"),10)||0),0>o.top?(r.scrollTop(r.scrollTop()+o.top-2),a):(o.top+=t.outerHeight(),i=r.height(),o.top>i&&r.scrollTop(r.scrollTop()+(o.top-i)+2),a)},changeValue:function(t){if(t[0]){var i,n,a=e("span.option-value",t).text(),r=e.prop(this.input,"value");this.options.multiple&&(n=r.split(f),n[n.length-1]=a,a=n.join(", ")),a!=r&&(e(this.input).prop("value",a).triggerHandler("updateInput"),this.changedValue=!0,(i=e.data(this.input,"wsspinner"))&&i.setInput&&i.setInput(a))}},markItem:function(t,i,n){var a;n=n||e("li:not(.hidden-item)",this.shadowList),n.length&&(0>t?t=n.length-1:t>=n.length&&(t=0),n.removeClass("active-item"),this.shadowList.addClass("list-item-active"),a=n.filter(":eq("+t+")").addClass("active-item"),i&&(this.changeValue(a),this.scrollIntoView(a)),this.index=t)}})});