webshims.register("forms-picker",function(e,t,n,i,a,r){"use strict";var o=t.picker,s=o._actions,l=r,u=function(e){var t=[e.getFullYear(),l.addZero(e.getMonth()+1),l.addZero(e.getDate())];return t.month=t[0]+"-"+t[1],t.date=t[0]+"-"+t[1]+"-"+t[2],t.time=l.addZero(e.getHours())+":"+l.addZero(e.getMinutes()),t["datetime-local"]=t.date+"T"+t.time,t},c=u(new Date),p=function(t){t=e(t||this.activeButton),this.activeButton.attr({tabindex:"-1","aria-selected":"false"}),this.activeButton=t.attr({tabindex:"0","aria-selected":"true"}),this.index=this.buttons.index(this.activeButton[0]),clearTimeout(this.timer),o._genericSetFocus.apply(this,arguments)},d=function(){var t;this.popover.navedInitFocus&&(t=this.popover.navedInitFocus.sel||this.popover.navedInitFocus,this.activeButton&&this.activeButton[0]||!this.buttons[t]?t&&(this.activeButton=e(t,this.element)):this.activeButton=this.buttons[t](),!this.activeButton[0]&&this.popover.navedInitFocus.alt&&(this.activeButton=this.buttons[this.popover.navedInitFocus.alt]())),this.activeButton&&this.activeButton[0]||(this.activeButton=this.buttons.filter(".checked-value")),this.activeButton[0]||(this.activeButton=this.buttons.filter(".this-value")),this.activeButton[0]||(this.activeButton=this.buttons.eq(0)),this.setFocus(this.activeButton,this.opts.noFocus)},f=t.formcfg,h=f[e.webshims.activeLang()]||f[""];e.webshims.activeLang({register:"form-core",callback:function(){e.each(arguments,function(e,t){return f[t]?(h=f[t],!1):a})}}),t.ListBox=function(t,n,i){this.element=e("ul",t),this.popover=n,this.opts=i||{},this.buttons=e("button:not(:disabled)",this.element),this.ons(this),this._initialFocus()},t.ListBox.prototype={setFocus:p,_initialFocus:d,prev:function(){var e=this.index-1;0>e?this.opts.prev&&(this.popover.navedInitFocus="last",this.popover.actionFn(this.opts.prev),this.popover.navedInitFocus=!1):this.setFocus(this.buttons.eq(e))},next:function(){var e=this.index+1;e>=this.buttons.length?this.opts.next&&(this.popover.navedInitFocus="first",this.popover.actionFn(this.opts.next),this.popover.navedInitFocus=!1):this.setFocus(this.buttons.eq(e))},ons:function(e){this.element.on({keydown:function(t){var n,i=t.keyCode;return t.ctrlKey?a:(36==i||33==i?(e.setFocus(e.buttons.eq(0)),n=!0):34==i||35==i?(e.setFocus(e.buttons.eq(e.buttons.length-1)),n=!0):38==i||37==i?(e.prev(),n=!0):(40==i||39==i)&&(e.next(),n=!0),n?!1:a)}})}},t.Grid=function(t,n,i){this.element=e("tbody",t),this.popover=n,this.opts=i||{},this.buttons=e("button:not(:disabled):not(.othermonth)",this.element),this.ons(this),this._initialFocus(),this.popover.openedByFocus&&(this.popover.activeElement=this.activeButton)},t.Grid.prototype={setFocus:p,_initialFocus:d,first:function(){this.setFocus(this.buttons.eq(0))},last:function(){this.setFocus(this.buttons.eq(this.buttons.length-1))},upPage:function(){e(".ws-picker-header > button:not(:disabled)",this.popover.element).trigger("click")},downPage:function(){this.activeButton.filter(':not([data-action="changeInput"])').trigger("click")},ons:function(e){this.element.on({keydown:function(t){var n,i=t.keyCode;return t.shiftKey?a:(t.ctrlKey&&40==i?n="downPage":t.ctrlKey&&38==i?n="upPage":33==i||t.ctrlKey&&37==i?n="prevPage":34==i||t.ctrlKey&&39==i?n="nextPage":36==t.keyCode||33==t.keyCode?n="first":35==t.keyCode?n="last":38==t.keyCode?n="up":37==t.keyCode?n="prev":40==t.keyCode?n="down":39==t.keyCode&&(n="next"),n?(e[n](),!1):a)}})}},e.each({prevPage:{get:"last",action:"prev"},nextPage:{get:"first",action:"next"}},function(e,n){t.Grid.prototype[e]=function(){this.opts[n.action]&&(this.popover.navedInitFocus={sel:'button[data-id="'+this.activeButton.attr("data-id")+'"]:not(:disabled,.othermonth)',alt:n.get},this.popover.actionFn(this.opts[n.action]),this.popover.navedInitFocus=!1)}}),e.each({up:{traverse:"prevAll",get:"last",action:"prev",reverse:!0},down:{traverse:"nextAll",get:"first",action:"next"}},function(n,i){t.Grid.prototype[n]=function(){var t=this.activeButton.closest("td").prop("cellIndex"),n="td:nth-child("+(t+1)+") button:not(:disabled,.othermonth)",a=this.activeButton.closest("tr")[i.traverse]();i.reverse&&(a=e(a.get().reverse())),a=a.find(n)[i.get](),a[0]?this.setFocus(a.eq(0)):this.opts[i.action]&&(this.popover.navedInitFocus=n+":"+i.get,this.popover.actionFn(this.opts[i.action]),this.popover.navedInitFocus=!1)}}),e.each({prev:{traverse:"prevAll",get:"last",reverse:!0},next:{traverse:"nextAll",get:"first"}},function(n,i){t.Grid.prototype[n]=function(){var t="button:not(:disabled,.othermonth)",a=this.activeButton.closest("td")[i.traverse]("td");i.reverse&&(a=e(a.get().reverse())),a=a.find(t)[i.get](),a[0]||(a=this.activeButton.closest("tr")[i.traverse]("tr"),i.reverse&&(a=e(a.get().reverse())),a=a.find(t)[i.get]()),a[0]?this.setFocus(a.eq(0)):this.opts[n]&&(this.popover.navedInitFocus=i.get,this.popover.actionFn(this.opts[n]),this.popover.navedInitFocus=!1)}}),o.getWeek=function(e){var t,n=new Date(e.getTime());return n.setDate(n.getDate()+4-(n.getDay()||7)),t=n.getTime(),n.setMonth(0),n.setDate(1),Math.floor(Math.round((t-n)/864e5)/7)+1},o.getYearList=function(e,t){var n,i,a,r,s,l,u,p,d,f,h=t.options,m=h.size,v=h.max.split("-"),g=h.min.split("-"),y=h.cols||4,b=h.value.split("-"),w=0,T=0,x="",N=0;for("max"==t.options.useDecadeBase&&v[0]?w=11-v[0]%12:"min"==t.options.useDecadeBase&&g[0]&&(w=11-g[0]%12),e=1*e[0],f=e-(e+w)%(12*m),n=0;m>n;n++){for(n?f+=12:l=o.isInRange([f-1],v,g)?{"data-action":"setYearList",value:f-1}:!1,x+='<div class="year-list picker-list ws-index-'+n+'"><div class="ws-picker-header"><button disabled="disabled">'+f+" \u2013 "+(f+11)+"</button></div>",s=[],i=0;12>i;i++)a=f+i,d=[],o.isInRange([a],v,g)?(r="",T++):r=' disabled=""',a==c[0]&&d.push("this-value"),b[0]==a&&d.push("checked-value"),p=d.length?' class="'+d.join(" ")+'"':"",!i||i%y||(N++,s.push('</tr><tr class="ws-row-'+N+'">')),s.push('<td class="ws-item-'+i+'" role="presentation"><button  data-id="year-'+i+'" type="button"'+r+p+' data-action="setMonthList" value="'+a+'" tabindex="-1" role="gridcell">'+a+"</button></td>");n==m-1&&(u=o.isInRange([a+1],v,g)?{"data-action":"setYearList",value:a+1}:!1),x+='<div class="picker-grid"><table role="grid" aria-label="'+f+" \u2013 "+(f+11)+'"><tbody><tr class="ws-row-0">'+s.join("")+"</tr></tbody></table></div></div>"}return{enabled:T,main:x,next:u,prev:l,type:"Grid"}},o.getMonthList=function(e,t){var n,i,a,r,s,l,u,p,d,f,m,v=t.options,g=v.size,y=v.max.split("-"),b=v.min.split("-"),w=v.cols||4,T=v.value.split("-"),x=0,N=0,E="";for(e=e[0]-Math.floor((g-1)/2),n=0;g>n;n++){for(n?e++:p=o.isInRange([e-1],y,b)?{"data-action":"setMonthList",value:e-1}:!1,n==g-1&&(d=o.isInRange([e+1],y,b)?{"data-action":"setMonthList",value:e+1}:!1),l=[],o.isInRange([e,"01"],y,b)||o.isInRange([e,"12"],y,b)?(u=!1,s=""):(s=' disabled=""',u=!0),v.minView>=1&&(s=' disabled=""'),E+='<div class="month-list picker-list ws-index-'+n+'"><div class="ws-picker-header">',E+=v.selectNav?'<select data-action="setMonthList" class="year-select">'+o.createYearSelect(e,y,b).join("")+"</select>":'<button data-action="setYearList"'+s+' value="'+e+'" tabindex="-1">'+e+"</button>",E+="</div>",i=0;12>i;i++)r=h.date.monthkeys[i+1],a=(h.date[v.monthNames]||h.date.monthNames)[i],m=[],u||!o.isInRange([e,r],y,b)?s=' disabled=""':(s="",x++),e==c[0]&&c[1]==r&&m.push("this-value"),T[0]==e&&T[1]==r&&m.push("checked-value"),f=m.length?' class="'+m.join(" ")+'"':"",!i||i%w||(N++,l.push('</tr><tr class="ws-row-'+N+'">')),l.push('<td class="ws-item-'+i+'" role="presentation"><button data-id="month-'+i+'" type="button"'+s+f+' data-action="'+("month"==t.type?"changeInput":"setDayList")+'" value="'+e+"-"+r+'" tabindex="-1" role="gridcell" aria-label="'+h.date.monthNames[i]+'">'+a+"</button></td>");E+='<div class="picker-grid"><table role="grid" aria-label="'+e+'"><tbody><tr class="ws-row-0">'+l.join("")+"</tr></tbody></table></div></div>"}return{enabled:x,main:E,prev:p,next:d,type:"Grid"}},o.getDayList=function(t,n){var i,a,r,s,l,p,d,f,m,v,g,y,b,w,T,x,N,E,A,k,S,C=n.options,M=C.size,_=C.max.split("-"),D=C.min.split("-"),P=C.value.split("-"),F=h.date[C.monthNamesHead]||h.date[C.monthNames]||h.date.monthNames,O=[],I=new Date(t[0],t[1]-1,1),j="datetime-local"==n.type?"setTimeList":"changeInput";for(I.setMonth(I.getMonth()-Math.floor((M-1)/2)),C.yearButtons&&(f=[1*t[0]+1,t[1]],f=o.isInRange(f,_,D)?{"data-action":"setDayList",value:f.join("-")}:!1,m=[1*t[0]-1,t[1]],m=o.isInRange(m,_,D)?{"data-action":"setDayList",value:m.join("-")}:!1),i=0;M>i;i++){for(I.setDate(1),b=I.getMonth(),y=0,i||(k=new Date(I.getTime()),k.setDate(-1),x=u(k),p=o.isInRange(x,_,D)?{"data-action":"setDayList",value:x[0]+"-"+x[1]}:!1),x=u(I),O.push('<div class="day-list picker-list ws-index-'+i+'"><div class="ws-picker-header">'),C.selectNav&&(N=['<select data-action="setDayList" class="month-select" tabindex="0">'+o.createMonthSelect(x,_,D,F).join("")+"</select>",'<select data-action="setDayList" class="year-select" tabindex="0">'+o.createYearSelect(x[0],_,D,"-"+x[1]).join("")+"</select>"],h.date.showMonthAfterYear&&N.reverse(),O.push(N.join(" "))),E=[h.date.monthNames[1*x[1]-1],x[0]],N=[F[1*x[1]-1],x[0]],h.date.showMonthAfterYear&&(N.reverse(),E.reverse()),n.options.selectNav||O.push('<button data-action="setMonthList"'+(C.minView>=2?' disabled="" ':"")+' value="'+x.date+'" tabindex="-1">'+N.join(" ")+"</button>"),O.push('</div><div class="picker-grid"><table role="grid" aria-label="'+E.join(" ")+'"><thead><tr>'),n.options.showWeek&&O.push('<th class="week-header">'+h.date.weekHeader+"</th>"),r=h.date.firstDay;h.date.dayNamesShort.length>r;r++)O.push('<th class="day-'+r+'"><abbr title="'+h.date.dayNames[r]+'">'+h.date.dayNamesShort[r]+"</abbr></th>");for(r=h.date.firstDay;r--;)O.push('<th class="day-'+r+'"><abbr title="'+h.date.dayNames[r]+'">'+h.date.dayNamesShort[r]+"</abbr></th>");for(O.push('</tr></thead><tbody><tr class="ws-row-0">'),n.options.showWeek&&(g=o.getWeek(I),O.push('<td class="week-cell">'+g+"</td>")),a=0;99>a;a++){if(v=a&&!(a%7),w=I.getMonth(),T=b!=w,s=I.getDay(),S=[],v&&T){O.push("</tr>");break}v&&(y++,O.push('</tr><tr class="ws-row-'+y+'">'),n.options.showWeek&&(g++,g>52&&(g=o.getWeek(I)),O.push('<td class="week-cell">'+g+"</td>"))),a||s!=h.date.firstDay&&(l=s-h.date.firstDay,0>l&&(l+=7),I.setDate(I.getDate()-l),s=I.getDay(),w=I.getMonth(),T=b!=w),x=u(I),A='<td role="presentation" class="day-'+s+'"><button data-id="day-'+I.getDate()+'" role="gridcell" data-action="'+j+'" value="'+x.join("-")+'" type="button"',T?S.push("othermonth"):S.push("day-"+I.getDate()),x[0]==c[0]&&c[1]==x[1]&&c[2]==x[2]&&S.push("this-value"),P[0]==x[0]&&x[1]==P[1]&&x[2]==P[2]&&S.push("checked-value"),S.length&&(A+=' class="'+S.join(" ")+'"'),(!o.isInRange(x,_,D)||n.options.disableDays&&-1!=e.inArray(s,n.options.disableDays))&&(A+=' disabled=""'),O.push(A+' tabindex="-1">'+I.getDate()+"</button></td>"),I.setDate(I.getDate()+1)}O.push("</tbody></table></div></div>"),i==M-1&&(x=u(I),x[2]=1,d=o.isInRange(x,_,D)?{"data-action":"setDayList",value:x.date}:!1)}return{enabled:9,main:O.join(""),prev:p,next:d,yearPrev:m,yearNext:f,type:"Grid"}},o.getTimeList=function(t,n){var i,a,r,o,s,u='<div class="time-list picker-list ws-index-0">',c=0,p=0,d=23,f={min:e.prop(n.orig,"min"),max:e.prop(n.orig,"max"),step:e.prop(n.orig,"step")},m=n.options,v=h.date[m.monthNamesHead]||h.date[m.monthNames]||h.date.monthNames,g="";for("time"==n.type?i='<button type="button" disabled="">'+e.trim(e(n.orig).jProp("labels").text()||"").replace(/[\:\*]/g,"")+"</button>":(a=t[2].split("T"),t[2]=a[0],a[1]&&(t[3]=a[1]),i=t[2]+". "+v[1*t[1]-1]+" "+t[0],g=' aria-label="'+i+'"',i='<button tabindex="-1" data-action="setDayList" value="'+t[0]+"-"+t[1]+"-"+t[2]+'" type="button">'+i+"</button>",s=t[0]+"-"+t[1]+"-"+t[2]+"T"),u+='<div class="ws-picker-header">'+i+"</div>",u+='<div class="picker-grid"><table role="grid"'+g+"><tbody><tr>";d>=c;c++)r=l.addZero(""+c)+":00",o=s?s+r:r,!c||c%4||(p++,u+='</tr><tr class="ws-row-'+p+'">'),u+='<td role="presentation"><button role="gridcell" data-action="changeInput" value="'+o+'" type="button" tabindex="-1"',n.isValid(o,f)||(u+=' disabled=""'),t==r&&(u+=' class="checked-value"'),u+=">"+n.formatValue(r)+"</button></td>";return u+="</tr></tbody></table></div></div>",{enabled:9,main:u,prev:!1,next:!1,type:"Grid"}},o.isInRange=function(e,t,n){var i,a=!0;for(i=0;e.length>i;i++){if(n[i]&&n[i]>e[i]){a=!1;break}if(!n[i]||n[i]!=e[i])break}if(a)for(i=0;e.length>i;i++){if(t[i]&&t[i]<e[i]){a=!1;break}if(!t[i]||t[i]!=e[i])break}return a},o.createMonthSelect=function(e,t,n,i){i||(i=h.date.monthNames);for(var a,r=0,s=[],u=e[1]-1;i.length>r;r++)a=u==r?' selected=""':"",(a||o.isInRange([e[0],r+1],t,n))&&s.push('<option value="'+e[0]+"-"+l.addZero(r+1)+'"'+a+">"+i[r]+"</option>");return s},o.createYearSelect=function(e,t,n,i){var a,r=!0,s=!0,l=['<option selected="">'+e+"</option>"],u=0;for(i||(i="");8>u&&(r||s);)u++,a=e-u,r&&o.isInRange([a],t,n)?l.unshift('<option value="'+(a+i)+'">'+a+"</option>"):r=!1,a=e+u,s&&o.isInRange([a],t,n)?l.push('<option value="'+(a+i)+'">'+a+"</option>"):s=!1;return l},function(){var n=function(e){return"get"+e+"List"},i=function(e){return"set"+e+"List"},a={date:"Day",week:"Day",month:"Month","datetime-local":"Time",time:"Time"},r=function(e,t,n){e[n]?t[n+"Element"].attr(e[n]).prop({disabled:!1}):t[n+"Element"].removeAttr("data-action").prop({disabled:!0})};e.each({setYearList:["Year","Month","Day","Time"],setMonthList:["Month","Day","Time"],setDayList:["Day","Time"],setTimeList:["Time"]},function(l,u){var c=u.map(n),p=u.map(i);s[l]=function(n,i,s,l){n=""+n;var d=s.options,f=n.split("-");l||(l=0),e.each(c,function(e,n){if(e>=l){var c=o[n](f,s);if(2>f.length||c.enabled>1||a[s.type]===u[e])return i.element.attr({"data-currentview":p[e]}).addClass("ws-size-"+d.size).data("pickercontent",{data:s,content:c,values:f}),i.bodyElement.html(c.main),r(c,i,"prev"),r(c,i,"next"),d.yearButtons&&(r(c,i,"yearPrev"),r(c,i,"yearNext")),t[c.type]&&new t[c.type](i.bodyElement.children(),i,c),i.element.trigger("pickerchange").filter('[data-vertical="bottom"]').triggerHandler("pospopover"),!1}})}})}(),o.showPickerContent=function(e,t){var n=e.options;e._popoverinit||(o.commonInit(e,t),o.commonDateInit(e,t)),!e._popoverinit||n.restartView?s.setYearList(n.defValue||n.value,t,e,n.startView):s[t.element.attr("data-currentview")||"setYearList"](n.defValue||n.value,t,e,0),e._popoverinit=!0},o.commonDateInit=function(n,a){var r=function(){return e(this).is(".othermonth")&&"pointer"!=e(this).css("cursor")||a.actionFn({"data-action":e.attr(this,"data-action"),value:e(this).val()||e.attr(this,"value")}),!1},l=(new Date).getTime(),u=function(i){var r=[],s="",u="";i.options=n.getOptions()||{},e("div.ws-options",a.contentElement).remove(),e.each(i.options[0],function(e,t){var a=o.isInRange(e.split("-"),i.maxS,i.minS)?"":' disabled="" ';t&&(t=' <span class="ws-label">'+t+"</span>"),r.push('<li role="presentation"><button value="'+e+'" '+a+' data-action="changeInput" tabindex="-1"  role="option"><span class="ws-value">'+n.formatValue(e,!1)+"</span>"+t+"</button></li>")}),r.length&&(l++,i.options[1]&&(u="datalist-"+l,s='<h5 id="'+u+'">'+i.options[1]+"</h5>",u=' aria-labelledbyid="'+u+'" '),new t.ListBox(e('<div class="ws-options">'+s+'<ul role="listbox" '+u+">"+r.join("")+"</div>").insertAfter(a.bodyElement)[0],a,{noFocus:!0}))},p=function(){if(a.isDirty){var i=n.options;i.maxS=i.max.split("-"),i.minS=i.min.split("-"),e("button",a.buttonRow).each(function(){var a;e(this).is(".ws-empty")?(a=h.date.clear,a||(a=f[""].date.clear||"clear",t.warn("could not get clear text from form cfg"))):e(this).is(".ws-current")&&(a=(h[n.type]||{}).currentText,a||(a=(f[""][[n.type]]||{}).currentText||(h.date||{}).currentText||"current",t.warn("could not get currentText from form cfg for "+n.type)),c[n.type]&&"time"!=n.type&&e.prop(this,"disabled",!o.isInRange(c[n.type].split("-"),i.maxS,i.minS))),a&&(e(this).text(a).attr({"aria-label":a}),t.assumeARIA&&e.attr(this,"aria-label",a))}),a.nextElement.attr({"aria-label":h.date.nextText}).find("span").html(h.date.nextText),a.prevElement.attr({"aria-label":h.date.prevText}).find("span").html(h.date.prevText),i.yearButtons&&(a.yearNextElement.attr({"aria-label":h.date.nextText}).find("span").html(h.date.nextText),a.yearPrevElement.attr({"aria-label":h.date.prevText}).find("span").html(h.date.prevText)),u(i,i.maxS,i.minS),a.isVisible&&o.showPickerContent(n,a)}e("button.ws-empty",a.buttonRow).prop("disabled",e.prop(n.orig,"required")),a.isDirty=!1};a.actionFn=function(e){s[e["data-action"]]?s[e["data-action"]](e.value,a,n,0):t.warn("no action for "+e["data-action"])},a.contentElement.html('<button class="ws-prev" tabindex="0"><span></span></button> <button class="ws-next" tabindex="0"><span></span></button><div class="ws-picker-body"></div><div class="ws-button-row"><button type="button" class="ws-current" data-action="changeInput" value="'+c[n.type]+'" tabindex="0"></button> <button type="button" data-action="changeInput" value="" class="ws-empty" tabindex="0"></button></div>'),a.nextElement=e("button.ws-next",a.contentElement),a.prevElement=e("button.ws-prev",a.contentElement),a.bodyElement=e("div.ws-picker-body",a.contentElement),a.buttonRow=e("div.ws-button-row",a.contentElement),a.element.on("updatepickercontent",p),n.options.yearButtons&&(a.element.addClass("ws-year-buttons"),a.yearNextElement=e('<button class="ws-super-next" tabindex="0"><span></span></button>').insertAfter(a.nextElement),a.yearPrevElement=e('<button class="ws-super-prev" tabindex="0"><span></span></button>').insertBefore(a.prevElement)),a.contentElement.on("click","button[data-action]",r).on("change","select[data-action]",r),n.options.inlinePicker&&(n.options.updateOnInput=!0),e(n.options.orig).on("input",function(){var e;n.options.updateOnInput&&a.isVisible&&n.options.value&&(e=a.element.attr("data-currentview"))&&s[e](n.options.value,a,n,0)}),e(i).onTrigger("wslocalechange",n._propertyChange)}});