webshims.register("forms-picker",function(e,t,n,a,i,r){"use strict";var o=t.picker,s=o._actions,u=r,l=function(e){var t=[e.getFullYear(),u.addZero(e.getMonth()+1),u.addZero(e.getDate())];return t.month=t[0]+"-"+t[1],t.date=t[0]+"-"+t[1]+"-"+t[2],t},c=l(new Date),p=function(t){t=e(t||this.activeButton),this.activeButton.attr({tabindex:"-1","aria-selected":"false"}),this.activeButton=t.attr({tabindex:"0","aria-selected":"true"}),this.index=this.buttons.index(this.activeButton[0]),clearTimeout(this.timer),o._genericSetFocus.apply(this,arguments)},d=function(){var t;this.popover.navedInitFocus&&(t=this.popover.navedInitFocus.sel||this.popover.navedInitFocus,this.activeButton&&this.activeButton[0]||!this.buttons[t]?t&&(this.activeButton=e(t,this.element)):this.activeButton=this.buttons[t](),!this.activeButton[0]&&this.popover.navedInitFocus.alt&&(this.activeButton=this.buttons[this.popover.navedInitFocus.alt]())),this.activeButton&&this.activeButton[0]||(this.activeButton=this.buttons.filter(".checked-value")),this.activeButton[0]||(this.activeButton=this.buttons.filter(".this-value")),this.activeButton[0]||(this.activeButton=this.buttons.eq(0)),this.setFocus(this.activeButton,this.opts.noFocus)},f=t.formcfg,h=f[e.webshims.activeLang()]||f[""];e.webshims.activeLang({register:"form-core",callback:function(){e.each(arguments,function(e,t){return f[t]?(h=f[t],!1):i})}}),t.ListBox=function(t,n,a){this.element=e("ul",t),this.popover=n,this.opts=a||{},this.buttons=e("button:not(:disabled)",this.element),this.ons(this),this._initialFocus()},t.ListBox.prototype={setFocus:p,_initialFocus:d,prev:function(){var e=this.index-1;0>e?this.opts.prev&&(this.popover.navedInitFocus="last",this.popover.actionFn(this.opts.prev),this.popover.navedInitFocus=!1):this.setFocus(this.buttons.eq(e))},next:function(){var e=this.index+1;e>=this.buttons.length?this.opts.next&&(this.popover.navedInitFocus="first",this.popover.actionFn(this.opts.next),this.popover.navedInitFocus=!1):this.setFocus(this.buttons.eq(e))},ons:function(e){this.element.on({keydown:function(t){var n,a=t.keyCode;return t.ctrlKey?i:(36==a||33==a?(e.setFocus(e.buttons.eq(0)),n=!0):34==a||35==a?(e.setFocus(e.buttons.eq(e.buttons.length-1)),n=!0):38==a||37==a?(e.prev(),n=!0):(40==a||39==a)&&(e.next(),n=!0),n?!1:i)}})}},t.Grid=function(t,n,a){this.element=e("tbody",t),this.popover=n,this.opts=a||{},this.buttons=e("button:not(:disabled,.othermonth)",this.element),this.ons(this),this._initialFocus(),this.popover.openedByFocus&&(this.popover.activeElement=this.activeButton)},t.Grid.prototype={setFocus:p,_initialFocus:d,first:function(){this.setFocus(this.buttons.eq(0))},last:function(){this.setFocus(this.buttons.eq(this.buttons.length-1))},upPage:function(){e(".ws-picker-header > button:not(:disabled)",this.popover.element).trigger("click")},downPage:function(){this.activeButton.filter(':not([data-action="changeInput"])').trigger("click")},ons:function(e){this.element.on({keydown:function(t){var n,a=t.keyCode;return t.shiftKey?i:(t.ctrlKey&&40==a?n="downPage":t.ctrlKey&&38==a?n="upPage":33==a||t.ctrlKey&&37==a?n="prevPage":34==a||t.ctrlKey&&39==a?n="nextPage":36==t.keyCode||33==t.keyCode?n="first":35==t.keyCode?n="last":38==t.keyCode?n="up":37==t.keyCode?n="prev":40==t.keyCode?n="down":39==t.keyCode&&(n="next"),n?(e[n](),!1):i)}})}},e.each({prevPage:{get:"last",action:"prev"},nextPage:{get:"first",action:"next"}},function(e,n){t.Grid.prototype[e]=function(){this.opts[n.action]&&(this.popover.navedInitFocus={sel:'button[data-id="'+this.activeButton.attr("data-id")+'"]:not(:disabled,.othermonth)',alt:n.get},this.popover.actionFn(this.opts[n.action]),this.popover.navedInitFocus=!1)}}),e.each({up:{traverse:"prevAll",get:"last",action:"prev",reverse:!0},down:{traverse:"nextAll",get:"first",action:"next"}},function(n,a){t.Grid.prototype[n]=function(){var t=this.activeButton.closest("td").prop("cellIndex"),n="td:nth-child("+(t+1)+") button:not(:disabled,.othermonth)",i=this.activeButton.closest("tr")[a.traverse]();a.reverse&&(i=e(i.get().reverse())),i=i.find(n)[a.get](),i[0]?this.setFocus(i.eq(0)):this.opts[a.action]&&(this.popover.navedInitFocus=n+":"+a.get,this.popover.actionFn(this.opts[a.action]),this.popover.navedInitFocus=!1)}}),e.each({prev:{traverse:"prevAll",get:"last",reverse:!0},next:{traverse:"nextAll",get:"first"}},function(n,a){t.Grid.prototype[n]=function(){var t="button:not(:disabled,.othermonth)",i=this.activeButton.closest("td")[a.traverse]("td");a.reverse&&(i=e(i.get().reverse())),i=i.find(t)[a.get](),i[0]||(i=this.activeButton.closest("tr")[a.traverse]("tr"),a.reverse&&(i=e(i.get().reverse())),i=i.find(t)[a.get]()),i[0]?this.setFocus(i.eq(0)):this.opts[n]&&(this.popover.navedInitFocus=a.get,this.popover.actionFn(this.opts[n]),this.popover.navedInitFocus=!1)}}),o.getWeek=function(e){var t=new Date(e.getFullYear(),0,1);return Math.ceil(((e-t)/864e5+t.getDay()+1)/7)},o.getYearList=function(e,t){var n,a,i,r,s,u,l,p,d,f,h=t.options.size,m=t.options.max.split("-"),v=t.options.min.split("-"),g=t.options.value.split("-"),y=0,b=0,w="",T=0;for("max"==t.options.useDecadeBase&&m[0]?y=11-m[0]%12:"min"==t.options.useDecadeBase&&v[0]&&(y=11-v[0]%12),e=1*e[0],f=e-(e+y)%(12*h),n=0;h>n;n++){for(n?f+=12:u=o.isInRange([f-1],m,v)?{"data-action":"setYearList",value:f-1}:!1,w+='<div class="year-list picker-list ws-index-'+n+'"><div class="ws-picker-header"><button disabled="disabled">'+f+" – "+(f+11)+"</button></div>",s=[],a=0;12>a;a++)i=f+a,d=[],o.isInRange([i],m,v)?(r="",b++):r=' disabled=""',i==c[0]&&d.push("this-value"),g[0]==i&&d.push("checked-value"),p=d.length?' class="'+d.join(" ")+'"':"",!a||a%3||(T++,s.push('</tr><tr class="ws-row-'+T+'">')),s.push('<td class="ws-item-'+a+'" role="presentation"><button  data-id="year-'+a+'" type="button"'+r+p+' data-action="setMonthList" value="'+i+'" tabindex="-1" role="gridcell">'+i+"</button></td>");n==h-1&&(l=o.isInRange([i+1],m,v)?{"data-action":"setYearList",value:i+1}:!1),w+='<div class="picker-grid"><table role="grid" aria-label="'+f+" – "+(f+11)+'"><tbody><tr class="ws-row-0">'+s.join("")+"</tr></tbody></table></div></div>"}return{enabled:b,main:w,next:l,prev:u,type:"Grid"}},o.getMonthList=function(e,t){var n,a,i,r,s,u,l,p,d,f,m,v=t.options,g=v.size,y=v.max.split("-"),b=v.min.split("-"),w=v.value.split("-"),T=0,x=0,N="";for(e=e[0]-Math.floor((g-1)/2),n=0;g>n;n++){for(n?e++:p=o.isInRange([e-1],y,b)?{"data-action":"setMonthList",value:e-1}:!1,n==g-1&&(d=o.isInRange([e+1],y,b)?{"data-action":"setMonthList",value:e+1}:!1),u=[],o.isInRange([e,"01"],y,b)||o.isInRange([e,"12"],y,b)?(l=!1,s=""):(s=' disabled=""',l=!0),v.minView>=1&&(s=' disabled=""'),N+='<div class="month-list picker-list ws-index-'+n+'"><div class="ws-picker-header">',N+=v.selectNav?'<select data-action="setMonthList" class="year-select">'+o.createYearSelect(e,y,b).join("")+"</select>":'<button data-action="setYearList"'+s+' value="'+e+'" tabindex="-1">'+e+"</button>",N+="</div>",a=0;12>a;a++)r=h.date.monthkeys[a+1],i=(h.date[v.monthNames]||h.date.monthNames)[a],m=[],l||!o.isInRange([e,r],y,b)?s=' disabled=""':(s="",T++),e==c[0]&&c[1]==r&&m.push("this-value"),w[0]==e&&w[1]==r&&m.push("checked-value"),f=m.length?' class="'+m.join(" ")+'"':"",!a||a%3||(x++,u.push('</tr><tr class="ws-row-'+x+'">')),u.push('<td class="ws-item-'+a+'" role="presentation"><button data-id="month-'+a+'" type="button"'+s+f+' data-action="'+("month"==t.type?"changeInput":"setDayList")+'" value="'+e+"-"+r+'" tabindex="-1" role="gridcell" aria-label="'+h.date.monthNames[a]+'">'+i+"</button></td>");N+='<div class="picker-grid"><table role="grid" aria-label="'+e+'"><tbody><tr class="ws-row-0">'+u.join("")+"</tr></tbody></table></div></div>"}return{enabled:T,main:N,prev:p,next:d,type:"Grid"}},o.getDayList=function(t,n){var a,i,r,s,u,p,d,f,m,v,g,y,b,w,T,x,N,E,A,k=n.options,C=k.size,S=k.max.split("-"),_=k.min.split("-"),D=k.value.split("-"),P=h.date[k.monthNamesHead]||h.date[k.monthNames]||h.date.monthNames,F=[],M=new Date(t[0],t[1]-1,1);for(M.setMonth(M.getMonth()-Math.floor((C-1)/2)),a=0;C>a;a++){for(M.setDate(1),g=M.getMonth(),v=0,a||(E=new Date(M.getTime()),E.setDate(-1),w=l(E),p=o.isInRange(w,S,_)?{"data-action":"setDayList",value:w[0]+"-"+w[1]}:!1),w=l(M),F.push('<div class="day-list picker-list ws-index-'+a+'"><div class="ws-picker-header">'),k.selectNav&&(T=['<select data-action="setDayList" class="month-select" tabindex="0">'+o.createMonthSelect(w,S,_,P).join("")+"</select>",'<select data-action="setDayList" class="year-select" tabindex="0">'+o.createYearSelect(w[0],S,_,"-"+w[1]).join("")+"</select>"],h.date.showMonthAfterYear&&T.reverse(),F.push(T.join(" "))),x=[h.date.monthNames[1*w[1]-1],w[0]],T=[P[1*w[1]-1],w[0]],h.date.showMonthAfterYear&&(T.reverse(),x.reverse()),n.options.selectNav||F.push('<button data-action="setMonthList"'+(k.minView>=2?' disabled="" ':"")+' value="'+w.date+'" tabindex="-1">'+T.join(" ")+"</button>"),F.push('</div><div class="picker-grid"><table role="grid" aria-label="'+x.join(" ")+'"><thead><tr>'),n.options.showWeek&&F.push('<th class="week-header">'+h.date.weekHeader+"</th>"),r=h.date.firstDay;h.date.dayNamesShort.length>r;r++)F.push('<th class="day-'+r+'"><abbr title="'+h.date.dayNames[r]+'">'+h.date.dayNamesShort[r]+"</abbr></th>");for(r=h.date.firstDay;r--;)F.push('<th class="day-'+r+'"><abbr title="'+h.date.dayNames[r]+'">'+h.date.dayNamesShort[r]+"</abbr></th>");for(F.push('</tr></thead><tbody><tr class="ws-row-0">'),n.options.showWeek&&(m=o.getWeek(M),F.push('<td class="week-cell">'+m+"</td>")),i=0;99>i;i++){if(f=i&&!(i%7),y=M.getMonth(),b=g!=y,s=M.getDay(),A=[],f&&b){F.push("</tr>");break}f&&(v++,F.push('</tr><tr class="ws-row-'+v+'">'),n.options.showWeek&&(m++,F.push('<td class="week-cell">'+m+"</td>"))),i||s!=h.date.firstDay&&(u=s-h.date.firstDay,0>u&&(u+=7),M.setDate(M.getDate()-u),s=M.getDay(),y=M.getMonth(),b=g!=y),w=l(M),N='<td role="presentation" class="day-'+s+'"><button data-id="day-'+M.getDate()+'" role="gridcell" data-action="changeInput" value="'+w.join("-")+'"',b?A.push("othermonth"):A.push("day-"+M.getDate()),w[0]==c[0]&&c[1]==w[1]&&c[2]==w[2]&&A.push("this-value"),D[0]==w[0]&&w[1]==D[1]&&w[2]==D[2]&&A.push("checked-value"),A.length&&(N+=' class="'+A.join(" ")+'"'),(!o.isInRange(w,S,_)||n.options.disableDays&&-1!=e.inArray(s,n.options.disableDays))&&(N+=' disabled=""'),F.push(N+' tabindex="-1">'+M.getDate()+"</button></td>"),M.setDate(M.getDate()+1)}F.push("</tbody></table></div></div>"),a==C-1&&(w=l(M),w[2]=1,d=o.isInRange(w,S,_)?{"data-action":"setDayList",value:w.date}:!1)}return{enabled:9,main:F.join(""),prev:p,next:d,type:"Grid"}},o.isInRange=function(e,t,n){var a,i=!0;for(a=0;e.length>a;a++){if(n[a]&&n[a]>e[a]){i=!1;break}if(!n[a]||n[a]!=e[a])break}if(i)for(a=0;e.length>a;a++){if(t[a]&&t[a]<e[a]){i=!1;break}if(!t[a]||t[a]!=e[a])break}return i},o.createMonthSelect=function(e,t,n,a){a||(a=h.date.monthNames);for(var i,r=0,s=[],l=e[1]-1;a.length>r;r++)i=l==r?' selected=""':"",(i||o.isInRange([e[0],r+1],t,n))&&s.push('<option value="'+e[0]+"-"+u.addZero(r+1)+'"'+i+">"+a[r]+"</option>");return s},o.createYearSelect=function(e,t,n,a){var i,r=!0,s=!0,u=['<option selected="">'+e+"</option>"],l=0;for(a||(a="");8>l&&(r||s);)l++,i=e-l,r&&o.isInRange([i],t,n)?u.unshift('<option value="'+(i+a)+'">'+i+"</option>"):r=!1,i=e+l,s&&o.isInRange([i],t,n)?u.push('<option value="'+(i+a)+'">'+i+"</option>"):s=!1;return u},function(){var n=function(e){return"get"+e+"List"},a=function(e){return"set"+e+"List"},i={date:"Day",week:"Day",month:"Month"};e.each({setYearList:["Year","Month","Day"],setMonthList:["Month","Day"],setDayList:["Day"]},function(r,u){var l=u.map(n),c=u.map(a);s[r]=function(n,a,r,s){n=""+n;var p=r.options,d=n.split("-");s||(s=0),e.each(l,function(e,n){if(e>=s){var l=o[n](d,r);if(2>d.length||l.enabled>1||i[r.type]===u[e])return a.element.attr({"data-currentview":c[e]}).addClass("ws-size-"+p.size).data("pickercontent",{data:r,content:l,values:d}),a.bodyElement.html(l.main),l.prev?a.prevElement.attr(l.prev).prop({disabled:!1}):a.prevElement.removeAttr("data-action").prop({disabled:!0}),l.next?a.nextElement.attr(l.next).prop({disabled:!1}):a.nextElement.removeAttr("data-action").prop({disabled:!0}),t[l.type]&&new t[l.type](a.bodyElement.children(),a,l),a.element.trigger("pickerchange"),!1}})}})}(),o.showPickerContent=function(e,t){var n=e.options;e._popoverinit||(o.commonInit(e,t),o.commonDateInit(e,t)),!e._popoverinit||n.restartView?s.setYearList(n.defValue||n.value,t,e,n.startView):s[t.element.attr("data-currentview")||"setYearList"](n.defValue||n.value,t,e,0),e._popoverinit=!0},o.commonDateInit=function(n,i){var r=function(){return e(this).is(".othermonth")&&"pointer"!=e(this).css("cursor")||i.actionFn({"data-action":e.attr(this,"data-action"),value:e(this).val()||e.attr(this,"value")}),!1},u=(new Date).getTime(),l=function(a){var r=[],s="",l="";a.options=n.getOptions()||{},e("div.ws-options",i.contentElement).remove(),e.each(a.options[0],function(e,t){var i=o.isInRange(e.split("-"),a.maxS,a.minS)?"":' disabled="" ';r.push('<li role="presentation"><button value="'+e+'" '+i+' data-action="changeInput" tabindex="-1"  role="option">'+(t||n.formatValue(e,!1))+"</button></li>")}),r.length&&(u++,a.options[1]&&(l="datalist-"+u,s='<h5 id="'+l+'">'+a.options[1]+"</h5>",l=' aria-labelledbyid="'+l+'" '),new t.ListBox(e('<div class="ws-options">'+s+'<ul role="listbox" '+l+">"+r.join("")+"</div>").insertAfter(i.bodyElement)[0],i,{noFocus:!0}))},p=function(){if(i.isDirty){var a=n.options;a.maxS=a.max.split("-"),a.minS=a.min.split("-"),e("button",i.buttonRow).each(function(){var i;e(this).is(".ws-empty")?(i=h.date.clear,i||(i=f[""].date.clear||"clear",t.warn("could not get clear text from form cfg"))):e(this).is(".ws-current")&&(i=(h[n.type]||{}).currentText,i||(i=(f[""][[n.type]]||{}).currentText||"current",t.warn("could not get currentText from form cfg")),e.prop(this,"disabled",!o.isInRange(c[n.type].split("-"),a.maxS,a.minS))),i&&(e(this).text(i).attr({"aria-label":i}),t.assumeARIA&&e.attr(this,"aria-label",i))}),i.nextElement.attr({"aria-label":h.date.nextText}),e("> span",i.nextElement).html(h.date.nextText),i.prevElement.attr({"aria-label":h.date.prevText}),e("> span",i.prevElement).html(h.date.prevText),l(a,a.maxS,a.minS)}e("button.ws-empty",i.buttonRow).prop("disabled",e.prop(n.orig,"required")),i.isDirty=!1};i.actionFn=function(e){s[e["data-action"]]?s[e["data-action"]](e.value,i,n,0):t.warn("no action for "+e["data-action"])},i.contentElement.html('<button class="ws-prev" tabindex="0"><span></span></button> <button class="ws-next" tabindex="0"><span></span></button><div class="ws-picker-body"></div><div class="ws-button-row"><button type="button" class="ws-current" data-action="changeInput" value="'+c[n.type]+'" tabindex="0"></button> <button type="button" data-action="changeInput" value="" class="ws-empty" tabindex="0"></button></div>'),i.nextElement=e("button.ws-next",i.contentElement),i.prevElement=e("button.ws-prev",i.contentElement),i.bodyElement=e("div.ws-picker-body",i.contentElement),i.buttonRow=e("div.ws-button-row",i.contentElement),i.element.on("updatepickercontent",p),i.contentElement.on("click","button[data-action]",r).on("change","select[data-action]",r),e(n.options.orig).on("input",function(){var e;n.options.updateOnInput&&i.isVisible&&n.options.value&&(e=i.element.attr("data-currentview"))&&s[e](n.options.value,i,n,0)}),e(a).onTrigger("wslocalechange",n._propertyChange)}});