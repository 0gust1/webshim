webshim.register("filereader",function(a,b,c,d){"use strict";var e,f=a.noop,g='input[type="file"].ws-filereader',h=function(){b.loader.loadList(["moxie"])},i=function(){var c,d,f,g=this;b.implement(g,"inputwidgets")&&(g=this,c=a(this),f=c.parent(),c.on("mousedown.filereaderwaiting click.filereaderwaiting",!1),f.addClass("ws-loading"),d=new e.FileInput({browse_button:this,accept:a.prop(this,"accept"),multiple:a.prop(this,"multiple")}),d.onready=function(){c.off(".fileraderwaiting"),f.removeClass("ws-waiting")},d.onchange=function(a){b.data(g,"fileList",a.target.files),c.trigger("change")},d.onmouseenter=function(){f.addClass("ws-mouseenter")},d.onmouseleave=function(){f.removeClass("ws-mouseenter")},d.onmousedown=function(){f.addClass("ws-active")},d.onmouseup=function(){f.removeClass("ws-active")},b.data(g,"filePicker",d),b.ready("WINDOWLOAD",function(){var a;c.onWSOff("updateshadowdom",function(){var b=g.offsetWidth;b&&a!=b&&(a=b,d.refresh())})}),b.addShadowDom(),d.init(),g.disabled&&d.disable(!0))},j=function(a){return a.name},k=function(){var c=this;h(),a(c).on("mousedown.filereaderwaiting click.filereaderwaiting",!1).parent().addClass("ws-loading"),b.ready("moxie",function(){k.call(c)})},l=function(){h(),b.error('filereader/formdata not ready yet. please wait for moxie to load `webshim.ready("moxie", callbackFn);`` or wait for the first change event on input[type="file"].ws-filereader.')},m=b.defineNodeNameProperty("input","value",{prop:{get:function(){var a=b.data(this,"fileList");return a&&a.map?a.map(j).join(", "):m.prop._supget.call(this)}}}),n=function(a){if("moxie"==a.wsType||a.data&&a.data instanceof f){var b;return{send:function(c,d){b=new moxie.xhr.XMLHttpRequest,b.open(a.type,a.url,a.async,a.username,a.password),b.send(a.data),b.addEventListener("readystatechange",function(){var a={text:b.responseText,xml:b.responseXML};4==b.readyState&&d(b.status,b.statusText,a)})},abort:function(){b&&b.abort()}}}},o={xdomain:function(a){"xdomain"==a.wsType},moxie:function(a){if("moxie"==a.wsType||a.data&&a.data instanceof f){var b;return{send:function(c,d){b=new moxie.xhr.XMLHttpRequest,b.open(a.type,a.url,a.async,a.username,a.password),b.send(a.data),b.addEventListener("readystatechange",function(){var a={text:b.responseText,xml:b.responseXML};4==b.readyState&&d(b.status,b.statusText,a)})},abort:function(){b&&b.abort()}}}}};a.support.cors===!1&&c.XDomainRequest||delete o.xdomain,a.ajaxTransport("+*",function(a,b,c){var d,e;if((a.wsType||o[o])&&(d=o[o](a,b,c)),!d)for(e in o)if(d=o[e](a,b,c))break;return d});var p=function(){var b,c=function(a){!a.isDefaultPrevented()};return function(){b||(b=!0,setTimeout(function(){a(d).on("submit",c)}))}}();p(),b.defineNodeNameProperty("input","files",{prop:{writeable:!1,get:function(){return"file"!=this.type?null:(a(this).is(".ws-filereader")||b.error("please add the 'ws-filereader' class to your input[type='file'] to implement files-property"),b.data(this,"fileList")||c.FileList&&b.data(this,"fileList",new FileList)||[])}}}),b.reflectProperties(["input"],["accept"]),null==a("<input />").prop("multiple")&&b.defineNodeNamesBooleanProperty(["input"],["multiple"]),b.onNodeNamesPropertyModify("input","disabled",function(a,c){var d=b.data(this,"filePicker");d&&d.disable(c)}),c.FileReader=l,c.FormData=l,b.ready("moxie",function(){e=c.mOxie,e.Env.swf_url=b.cfg.basePath+"moxie/flash/Moxie.cdn.swf",e.Env.xap_url=b.cfg.basePath+"moxie/flash/Moxie.cdn.xap",c.FileReader=e.FileReader,c.FormData=e.FormData,f=e.FormData,k=i,o.moxie=n}),b.addReady(function(b,c){a(b.querySelectorAll(g)).add(c.filter(g)).each(k)}),b.ready("WINDOWLOAD",h)});